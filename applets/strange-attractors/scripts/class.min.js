import{AnimationFrameApplet}from"/scripts/applets/animationFrameApplet.min.js";import{addTemporaryWorker}from"/scripts/src/main.min.js";import{WilsonCPU}from"/scripts/wilson.min.js";const brightnessScale=10;class StrangeAttractors extends AnimationFrameApplet{webWorker;brightnesses;imageData;pixels;constructor({canvas}){super(canvas);this.wilson=new WilsonCPU(canvas,{canvasWidth:500,fullscreenOptions:{useFullscreenButton:!0,enterFullscreenButtonIconPath:"/graphics/general-icons/enter-fullscreen.png",exitFullscreenButtonIconPath:"/graphics/general-icons/exit-fullscreen.png"}})}run({resolution,sigma,rho,beta,maximumSpeed}){this.resolution=resolution,this.maximumSpeed=maximumSpeed,this.wilson.resizeCanvas({width:this.resolution}),this.pixels=[],this.imageData=new Uint8ClampedArray(this.resolution*this.resolution*4);for(let s=0;s<this.resolution*this.resolution;s++)this.imageData[4*s+3]=255;this.brightnesses=new Uint8ClampedArray(this.resolution*this.resolution),this.webWorker=addTemporaryWorker("/applets/strange-attractors/scripts/worker.js"),this.webWorker.onmessage=e=>{this.pixels.push(...e.data),this.needNewFrame=!0},this.webWorker.postMessage([resolution,sigma,rho,beta]),this.resume()}drawFrame(){var s=this.maximumSpeed?this.pixels.length:Math.min(Math.ceil(this.resolution*this.resolution/100),this.pixels.length);for(let i=0;i<s;i++){var e=this.pixels[i][0]*this.resolution+this.pixels[i][1],t=(this.brightnesses[e]++,this.brightnesses[e]/brightnessScale);this.imageData[4*e]=this.pixels[i][2][0]*t,this.imageData[4*e+1]=this.pixels[i][2][1]*t,this.imageData[4*e+2]=this.pixels[i][2][2]*t}this.pixels.splice(0,s),this.wilson.drawFrame(this.imageData),0!==this.pixels.length&&(this.needNewFrame=!0)}}export{StrangeAttractors};