"use strict";let numVertices,gridSize,image=[],vertices=[],centerRow,centerCol,currentRow,currentCol,numPixelsAtMax=0;function drawChaosGame(){image=new Uint8ClampedArray(gridSize*gridSize*4);for(let c=0;c<gridSize;c++)for(let e=0;e<gridSize;e++)image[4*(gridSize*c+e)]=0,image[4*(gridSize*c+e)+1]=0,image[4*(gridSize*c+e)+2]=0,image[4*(gridSize*c+e)+3]=255;var e=2*Math.floor(numVertices/2)*Math.PI/numVertices,r=gridSize/2-gridSize/2.5,e=gridSize/2-gridSize/2.5*Math.cos(e),r=r+(gridSize-e);centerRow=Math.floor(r/2+gridSize/2.5),centerCol=Math.floor(gridSize/2),currentRow=centerRow,currentCol=centerCol,vertices=[];for(let g=0;g<numVertices;g++){var i=g/numVertices*2*Math.PI,t=Math.floor(-Math.cos(i)*gridSize/2.5+centerRow),i=Math.floor(Math.sin(i)*gridSize/2.5+centerCol);vertices.push([t,i])}let a=0;for(;;){a%(100*gridSize)==0&&postMessage([image]);var o=Math.floor(Math.random()*numVertices),o=(currentRow=Math.floor((currentRow+vertices[o][0])/2),currentCol=Math.floor((currentCol+vertices[o][1])/2),(Math.atan2(currentCol-gridSize/2,currentRow-gridSize/2)+Math.PI)/(2*Math.PI)),n=HSVtoRGB(o,((currentRow-gridSize/2)*(currentRow-gridSize/2)+(currentCol-gridSize/2)*(currentCol-gridSize/2))/(gridSize*gridSize/13),1);n[0]/=255,n[1]/=255,n[2]/=255;for(let e=0;e<3;e++)if(image[4*(gridSize*currentRow+currentCol)+e]+=8*n[e],255<=image[4*(gridSize*currentRow+currentCol)+e]&&(numPixelsAtMax++,image[4*(gridSize*currentRow+currentCol)+e]=255,.004<numPixelsAtMax/(gridSize*gridSize)))return void postMessage([image]);a++}}function HSVtoRGB(h,s,v){let e,r,i;var t=Math.floor(6*h),a=6*h-t,o=v*(1-s),n=v*(1-a*s),c=v*(1-(1-a)*s);switch(t%6){case 0:e=v,r=c,i=o;break;case 1:e=n,r=v,i=o;break;case 2:e=o,r=v,i=c;break;case 3:e=o,r=n,i=v;break;case 4:e=c,r=o,i=v;break;case 5:e=v,r=o,i=n}return[Math.round(255*e),Math.round(255*r),Math.round(255*i)]}onmessage=e=>{numVertices=e.data[0],gridSize=e.data[1],drawChaosGame()};