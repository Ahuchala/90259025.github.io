var _Wilson_instances,_Wilson_destroyed,_Wilson_canvasWidth,_Wilson_canvasHeight,_Wilson_lastCanvasWidth,_Wilson_lastCanvasHeight,_Wilson_canvasAspectRatio,_Wilson_worldWidth,_Wilson_worldHeight,_Wilson_worldCenterX,_Wilson_worldCenterY,_Wilson_nonFullscreenWorldWidth,_Wilson_nonFullscreenWorldHeight,_Wilson_minWorldWidth,_Wilson_maxWorldWidth,_Wilson_minWorldHeight,_Wilson_maxWorldHeight,_Wilson_minWorldX,_Wilson_maxWorldX,_Wilson_minWorldY,_Wilson_maxWorldY,_Wilson_onResizeCanvasCallback,_Wilson_useP3ColorSpace,_Wilson_needDraggablesContainerSizeUpdate,_Wilson_interactionCallbacks,_Wilson_needPanAndZoomUpdate,_Wilson_interactionOnPanAndZoom,_Wilson_numPreviousVelocities,_Wilson_lastVelocityFactors,_Wilson_lastPanVelocityX,_Wilson_lastPanVelocityY,_Wilson_lastZoomVelocity,_Wilson_lastPanVelocitiesX,_Wilson_lastPanVelocitiesY,_Wilson_lastZoomVelocities,_Wilson_panVelocityX,_Wilson_panVelocityY,_Wilson_zoomVelocity,_Wilson_panFriction,_Wilson_zoomFriction,_Wilson_panVelocityThreshold,_Wilson_zoomVelocityThreshold,_Wilson_draggablesRadius,_Wilson_draggablesStatic,_Wilson_draggableCallbacks,_Wilson_draggablesContainerWidth,_Wilson_draggablesContainerHeight,_Wilson_draggablesContainerRestrictedWidth,_Wilson_draggablesContainerRestrictedHeight,_Wilson_currentlyFullscreen,_Wilson_fullscreenOldScroll,_Wilson_fullscreenFillScreen,_Wilson_fullscreenUseButton,_Wilson_fullscreenEnterFullscreenButton,_Wilson_fullscreenExitFullscreenButton,_Wilson_fullscreenEnterFullscreenButtonIconPath,_Wilson_fullscreenExitFullscreenButtonIconPath,_Wilson_appletContainer,_Wilson_canvasContainer,_Wilson_draggablesContainer,_Wilson_fullscreenContainer,_Wilson_fullscreenContainerLocation,_Wilson_metaThemeColorElement,_Wilson_oldMetaThemeColor,_Wilson_salt,_Wilson_onResizeWindow,_Wilson_handleKeydownEvent,_Wilson_resizeCanvas,_Wilson_zeroVelocities,_Wilson_setLastZoomVelocity,_Wilson_setLastPanVelocity,_Wilson_setZoomVelocity,_Wilson_setPanVelocity,_Wilson_currentlyDragging,_Wilson_currentlyPinching,_Wilson_currentlyWheeling,_Wilson_currentlyWheelingTimeoutId,_Wilson_ignoreTouchendCooldown,_Wilson_atMaxWorldSize,_Wilson_atMinWorldSize,_Wilson_lastInteractionRow,_Wilson_lastInteractionCol,_Wilson_lastInteractionRow2,_Wilson_lastInteractionCol2,_Wilson_clampWorldCoordinates,_Wilson_onMousedown,_Wilson_onMouseup,_Wilson_onMouseleave,_Wilson_onMousemove,_Wilson_updateFromPinching,_Wilson_onTouchstart,_Wilson_onTouchend,_Wilson_onTouchmove,_Wilson_zoomFixedPoint,_Wilson_zoomCanvas,_Wilson_onWheel,_Wilson_lastPanAndZoomTimestamp,_Wilson_animationFrameLoop,_Wilson_initInteraction,_Wilson_draggables,_Wilson_draggableDefaultId,_Wilson_currentMouseDraggableId,_Wilson_documentDraggableMousemoveListener,_Wilson_documentDraggableMouseupListener,_Wilson_initDraggables,_Wilson_draggableOnMousedown,_Wilson_draggableOnMouseup,_Wilson_draggableOnMousemove,_Wilson_draggableOnTouchstart,_Wilson_draggableOnTouchend,_Wilson_draggableOnTouchmove,_Wilson_updateDraggablesContainerSize,_Wilson_updateDraggablesLocation,_Wilson_initFullscreen,_Wilson_preventGestures,_Wilson_canvasOldWidth,_Wilson_canvasOldWidthStyle,_Wilson_canvasOldHeightStyle,_Wilson_enterFullscreen,_Wilson_exitFullscreen,_Wilson_interpolatePageToWorld,_WilsonGPU_instances,_WilsonGPU_useWebGL2,_WilsonGPU_shaderPrograms,_WilsonGPU_uniforms,_WilsonGPU_loadShaderInternal,_WilsonGPU_numShaders,_WilsonGPU_currentShaderId,_WilsonGPU_framebuffers,_WilsonGPU_textures,__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value;throw new TypeError("Cannot write private member to an object whose class did not declare it")},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver===state&&f:state.has(receiver))return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver);throw new TypeError("Cannot read private member from an object whose class did not declare it")};const defaultInteractionCallbacks={mousedown:({})=>{},mouseup:({})=>{},mouseleave:({})=>{},mousemove:({})=>{},mousedrag:({})=>{},touchstart:({})=>{},touchend:({})=>{},touchmove:({})=>{},wheel:({})=>{}},defaultDraggableCallbacks={grab:({})=>{},drag:({})=>{},release:({})=>{}};class Wilson{constructor(canvas,options){_Wilson_instances.add(this),_Wilson_destroyed.set(this,!1),_Wilson_canvasWidth.set(this,void 0),_Wilson_canvasHeight.set(this,void 0),_Wilson_lastCanvasWidth.set(this,void 0),_Wilson_lastCanvasHeight.set(this,void 0),_Wilson_canvasAspectRatio.set(this,void 0),_Wilson_worldWidth.set(this,void 0),_Wilson_worldHeight.set(this,void 0),_Wilson_worldCenterX.set(this,void 0),_Wilson_worldCenterY.set(this,void 0),_Wilson_nonFullscreenWorldWidth.set(this,void 0),_Wilson_nonFullscreenWorldHeight.set(this,void 0),_Wilson_minWorldWidth.set(this,void 0),_Wilson_maxWorldWidth.set(this,void 0),_Wilson_minWorldHeight.set(this,void 0),_Wilson_maxWorldHeight.set(this,void 0),_Wilson_minWorldX.set(this,void 0),_Wilson_maxWorldX.set(this,void 0),_Wilson_minWorldY.set(this,void 0),_Wilson_maxWorldY.set(this,void 0),_Wilson_onResizeCanvasCallback.set(this,void 0),_Wilson_useP3ColorSpace.set(this,void 0),_Wilson_needDraggablesContainerSizeUpdate.set(this,!1),_Wilson_interactionCallbacks.set(this,void 0),this.usePanAndZoomRubberbanding=!0,this.rubberbandingPanSoftness=3.5,this.rubberbandingZoomSoftness=2,this.disallowZooming=!1,_Wilson_needPanAndZoomUpdate.set(this,!1),_Wilson_interactionOnPanAndZoom.set(this,()=>{}),_Wilson_numPreviousVelocities.set(this,4),_Wilson_lastVelocityFactors.set(this,[]),_Wilson_lastPanVelocityX.set(this,0),_Wilson_lastPanVelocityY.set(this,0),_Wilson_lastZoomVelocity.set(this,0),_Wilson_lastPanVelocitiesX.set(this,[]),_Wilson_lastPanVelocitiesY.set(this,[]),_Wilson_lastZoomVelocities.set(this,[]),_Wilson_panVelocityX.set(this,0),_Wilson_panVelocityY.set(this,0),_Wilson_zoomVelocity.set(this,0),_Wilson_panFriction.set(this,void 0),_Wilson_zoomFriction.set(this,void 0),_Wilson_panVelocityThreshold.set(this,.001),_Wilson_zoomVelocityThreshold.set(this,.001),_Wilson_draggablesRadius.set(this,void 0),_Wilson_draggablesStatic.set(this,void 0),_Wilson_draggableCallbacks.set(this,void 0),_Wilson_draggablesContainerWidth.set(this,0),_Wilson_draggablesContainerHeight.set(this,0),_Wilson_draggablesContainerRestrictedWidth.set(this,0),_Wilson_draggablesContainerRestrictedHeight.set(this,0),_Wilson_currentlyFullscreen.set(this,!1),this.currentlyFullscreen=!1,_Wilson_fullscreenOldScroll.set(this,0),_Wilson_fullscreenFillScreen.set(this,void 0),_Wilson_fullscreenUseButton.set(this,void 0),_Wilson_fullscreenEnterFullscreenButton.set(this,null),_Wilson_fullscreenExitFullscreenButton.set(this,null),_Wilson_fullscreenEnterFullscreenButtonIconPath.set(this,void 0),_Wilson_fullscreenExitFullscreenButtonIconPath.set(this,void 0),_Wilson_appletContainer.set(this,void 0),_Wilson_canvasContainer.set(this,void 0),_Wilson_draggablesContainer.set(this,void 0),_Wilson_fullscreenContainer.set(this,void 0),_Wilson_fullscreenContainerLocation.set(this,void 0),_Wilson_metaThemeColorElement.set(this,document.querySelector("meta[name='theme-color']")),_Wilson_oldMetaThemeColor.set(this,null),_Wilson_salt.set(this,Date.now().toString(36)+Math.random().toString(36).slice(2)),_Wilson_onResizeWindow.set(this,()=>{var e=()=>{var e,i;__classPrivateFieldGet(this,_Wilson_currentlyFullscreen,"f")&&__classPrivateFieldGet(this,_Wilson_fullscreenFillScreen,"f")&&(i=(e=window.innerWidth/window.innerHeight)/__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f"),this.canvas.style.width="100vw",this.canvas.style.height="100vh",requestAnimationFrame(()=>this.canvas.style.height="100%"),window.scroll(0,0),__classPrivateFieldSet(this,_Wilson_worldWidth,Math.max(__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldWidth,"f")*i,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldWidth,"f")),"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,Math.max(__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldHeight,"f")/i,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldHeight,"f")),"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_clampWorldCoordinates).call(this),i=Math.round(Math.sqrt(__classPrivateFieldGet(this,_Wilson_canvasWidth,"f")*__classPrivateFieldGet(this,_Wilson_canvasHeight,"f")*e)),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_resizeCanvas).call(this,{width:i}))&&__classPrivateFieldGet(this,_Wilson_onResizeCanvasCallback,"f").call(this),__classPrivateFieldSet(this,_Wilson_needDraggablesContainerSizeUpdate,!0,"f")};e(),setTimeout(e,10),setTimeout(e,50)}),_Wilson_handleKeydownEvent.set(this,e=>{"Escape"===e.key&&__classPrivateFieldGet(this,_Wilson_currentlyFullscreen,"f")&&this.closeFullscreenWithEscape&&(e.preventDefault(),e.stopPropagation(),this.exitFullscreen())}),this.resizeCanvasGPU=()=>{},_Wilson_currentlyDragging.set(this,!1),_Wilson_currentlyPinching.set(this,!1),_Wilson_currentlyWheeling.set(this,!1),_Wilson_currentlyWheelingTimeoutId.set(this,-1),_Wilson_ignoreTouchendCooldown.set(this,0),_Wilson_atMaxWorldSize.set(this,!1),_Wilson_atMinWorldSize.set(this,!1),_Wilson_lastInteractionRow.set(this,0),_Wilson_lastInteractionCol.set(this,0),_Wilson_lastInteractionRow2.set(this,0),_Wilson_lastInteractionCol2.set(this,0),_Wilson_zoomFixedPoint.set(this,[0,0]),_Wilson_lastPanAndZoomTimestamp.set(this,-1),_Wilson_animationFrameLoop.set(this,timestamp=>{var e,i=timestamp-__classPrivateFieldGet(this,_Wilson_lastPanAndZoomTimestamp,"f");__classPrivateFieldSet(this,_Wilson_lastPanAndZoomTimestamp,timestamp,"f"),this.useInteractionForPanAndZoom&&(__classPrivateFieldGet(this,_Wilson_lastZoomVelocities,"f").shift(),__classPrivateFieldGet(this,_Wilson_lastZoomVelocities,"f").push(__classPrivateFieldGet(this,_Wilson_lastZoomVelocity,"f")),__classPrivateFieldSet(this,_Wilson_lastZoomVelocity,0,"f"),__classPrivateFieldGet(this,_Wilson_lastPanVelocitiesX,"f").shift(),__classPrivateFieldGet(this,_Wilson_lastPanVelocitiesX,"f").push(__classPrivateFieldGet(this,_Wilson_lastPanVelocityX,"f")),__classPrivateFieldSet(this,_Wilson_lastPanVelocityX,0,"f"),__classPrivateFieldGet(this,_Wilson_lastPanVelocitiesY,"f").shift(),__classPrivateFieldGet(this,_Wilson_lastPanVelocitiesY,"f").push(__classPrivateFieldGet(this,_Wilson_lastPanVelocityY,"f")),__classPrivateFieldSet(this,_Wilson_lastPanVelocityY,0,"f"),__classPrivateFieldGet(this,_Wilson_lastVelocityFactors,"f").shift(),__classPrivateFieldGet(this,_Wilson_lastVelocityFactors,"f").push(Math.max(i/(1e3/60),1)),__classPrivateFieldSet(this,_Wilson_ignoreTouchendCooldown,Math.max(0,__classPrivateFieldGet(this,_Wilson_ignoreTouchendCooldown,"f")-i),"f")),0==i||1e4<i||(__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f")&&(__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_zoomCanvas).call(this,1+.005*__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f")),__classPrivateFieldSet(this,_Wilson_zoomVelocity,__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f")*Math.pow(__classPrivateFieldGet(this,_Wilson_zoomFriction,"f"),i/(1e3/60)),"f"),Math.abs(__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f"))<__classPrivateFieldGet(this,_Wilson_zoomVelocityThreshold,"f"))&&__classPrivateFieldSet(this,_Wilson_zoomVelocity,0,"f"),(__classPrivateFieldGet(this,_Wilson_panVelocityX,"f")||__classPrivateFieldGet(this,_Wilson_panVelocityY,"f"))&&(__classPrivateFieldSet(this,_Wilson_worldCenterX,__classPrivateFieldGet(this,_Wilson_worldCenterX,"f")+__classPrivateFieldGet(this,_Wilson_panVelocityX,"f"),"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,__classPrivateFieldGet(this,_Wilson_worldCenterY,"f")+__classPrivateFieldGet(this,_Wilson_panVelocityY,"f"),"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f"),e=Math.pow(__classPrivateFieldGet(this,_Wilson_panFriction,"f"),i/(1e3/60)),__classPrivateFieldSet(this,_Wilson_panVelocityX,__classPrivateFieldGet(this,_Wilson_panVelocityX,"f")*e,"f"),__classPrivateFieldSet(this,_Wilson_panVelocityY,__classPrivateFieldGet(this,_Wilson_panVelocityY,"f")*e,"f"),__classPrivateFieldGet(this,_Wilson_panVelocityX,"f")*__classPrivateFieldGet(this,_Wilson_panVelocityX,"f")+__classPrivateFieldGet(this,_Wilson_panVelocityY,"f")*__classPrivateFieldGet(this,_Wilson_panVelocityY,"f")<(e=__classPrivateFieldGet(this,_Wilson_panVelocityThreshold,"f")*Math.min(__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldGet(this,_Wilson_worldHeight,"f")))*e)&&(__classPrivateFieldSet(this,_Wilson_panVelocityX,0,"f"),__classPrivateFieldSet(this,_Wilson_panVelocityY,0,"f")),__classPrivateFieldGet(this,_Wilson_needPanAndZoomUpdate,"f")&&(__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!1,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_clampWorldCoordinates).call(this,Math.min(i/(1e3/60),1)),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_updateDraggablesLocation).call(this),__classPrivateFieldGet(this,_Wilson_interactionOnPanAndZoom,"f").call(this)),__classPrivateFieldGet(this,_Wilson_needDraggablesContainerSizeUpdate,"f")&&(requestAnimationFrame(()=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_updateDraggablesContainerSize).call(this)),__classPrivateFieldSet(this,_Wilson_needDraggablesContainerSizeUpdate,!1,"f"))),__classPrivateFieldGet(this,_Wilson_destroyed,"f")||requestAnimationFrame(__classPrivateFieldGet(this,_Wilson_animationFrameLoop,"f"))}),_Wilson_draggables.set(this,{}),this.draggables={},_Wilson_draggableDefaultId.set(this,0),_Wilson_currentMouseDraggableId.set(this,void 0),_Wilson_documentDraggableMousemoveListener.set(this,e=>{void 0!==__classPrivateFieldGet(this,_Wilson_currentMouseDraggableId,"f")&&__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_draggableOnMousemove).call(this,e,__classPrivateFieldGet(this,_Wilson_currentMouseDraggableId,"f"))}),_Wilson_documentDraggableMouseupListener.set(this,e=>{void 0!==__classPrivateFieldGet(this,_Wilson_currentMouseDraggableId,"f")&&__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_draggableOnMouseup).call(this,e,__classPrivateFieldGet(this,_Wilson_currentMouseDraggableId,"f"))}),_Wilson_preventGestures.set(this,e=>{e.preventDefault()}),_Wilson_canvasOldWidth.set(this,0),_Wilson_canvasOldWidthStyle.set(this,""),_Wilson_canvasOldHeightStyle.set(this,""),this.canvas=canvas;var e=getComputedStyle(this.canvas);if(__classPrivateFieldSet(this,_Wilson_canvasAspectRatio,parseFloat(e.width)/parseFloat(e.height),"f"),!__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")||__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")<=0||__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")===1/0)throw new Error("[Wilson] Could not get canvas aspect ratio. Check that the canvas has a nonzero width and height and is displayed on the page.");if(void 0===options.canvasWidth&&void 0===options.canvasHeight)throw new Error("[Wilson] Exactly one of canvasWidth and canvasHeight must be specified.");if(void 0!==options.canvasWidth?(__classPrivateFieldSet(this,_Wilson_canvasWidth,Math.round(options.canvasWidth),"f"),this.canvasWidth=__classPrivateFieldGet(this,_Wilson_canvasWidth,"f"),__classPrivateFieldSet(this,_Wilson_canvasHeight,Math.round(options.canvasWidth/__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")),"f")):(__classPrivateFieldSet(this,_Wilson_canvasWidth,Math.round(options.canvasHeight*__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")),"f"),this.canvasWidth=__classPrivateFieldGet(this,_Wilson_canvasWidth,"f"),__classPrivateFieldSet(this,_Wilson_canvasHeight,Math.round(options.canvasHeight),"f")),this.canvasHeight=__classPrivateFieldGet(this,_Wilson_canvasHeight,"f"),__classPrivateFieldSet(this,_Wilson_lastCanvasWidth,__classPrivateFieldGet(this,_Wilson_canvasWidth,"f"),"f"),__classPrivateFieldSet(this,_Wilson_lastCanvasHeight,__classPrivateFieldGet(this,_Wilson_canvasHeight,"f"),"f"),this.canvas.setAttribute("width",__classPrivateFieldGet(this,_Wilson_canvasWidth,"f").toString()),this.canvas.setAttribute("height",__classPrivateFieldGet(this,_Wilson_canvasHeight,"f").toString()),new ResizeObserver(()=>{__classPrivateFieldSet(this,_Wilson_needDraggablesContainerSizeUpdate,!0,"f")}).observe(this.canvas),void 0!==options.worldWidth&&void 0!==options.worldHeight?(__classPrivateFieldSet(this,_Wilson_worldWidth,options.worldWidth,"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,options.worldHeight,"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f")):void 0!==options.worldHeight?(__classPrivateFieldSet(this,_Wilson_worldHeight,options.worldHeight,"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldSet(this,_Wilson_worldWidth,__classPrivateFieldGet(this,_Wilson_worldHeight,"f")*__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f"),"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f")):(void 0!==options.worldWidth?(__classPrivateFieldSet(this,_Wilson_worldWidth,options.worldWidth,"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,__classPrivateFieldGet(this,_Wilson_worldWidth,"f")/__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f"),"f")):(__classPrivateFieldSet(this,_Wilson_worldWidth,Math.max(2,2*__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")),"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,Math.max(2,2/__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")),"f")),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f")),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldWidth,__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldHeight,__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),"f"),__classPrivateFieldSet(this,_Wilson_worldCenterX,null!=(e=options.worldCenterX)?e:0,"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,null!=(e=options.worldCenterY)?e:0,"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),__classPrivateFieldSet(this,_Wilson_minWorldX,null!=(e=options.minWorldX)?e:-1/0,"f"),__classPrivateFieldSet(this,_Wilson_maxWorldX,null!=(e=options.maxWorldX)?e:1/0,"f"),__classPrivateFieldSet(this,_Wilson_minWorldY,null!=(e=options.minWorldY)?e:-1/0,"f"),__classPrivateFieldSet(this,_Wilson_maxWorldY,null!=(e=options.maxWorldY)?e:1/0,"f"),__classPrivateFieldSet(this,_Wilson_maxWorldWidth,void 0!==options.minWorldX&&void 0!==options.maxWorldX?options.maxWorldX-options.minWorldX:null!=(e=options.maxWorldWidth)?e:1/0,"f"),__classPrivateFieldSet(this,_Wilson_minWorldWidth,null!=(e=options.minWorldWidth)?e:0,"f"),__classPrivateFieldSet(this,_Wilson_maxWorldHeight,void 0!==options.minWorldY&&void 0!==options.maxWorldY?options.maxWorldY-options.minWorldY:null!=(e=options.maxWorldHeight)?e:1/0,"f"),__classPrivateFieldSet(this,_Wilson_minWorldHeight,null!=(e=options.minWorldHeight)?e:0,"f"),__classPrivateFieldGet(this,_Wilson_minWorldX,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldX,"f")||__classPrivateFieldGet(this,_Wilson_minWorldY,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldY,"f")||__classPrivateFieldGet(this,_Wilson_minWorldWidth,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldWidth,"f")||__classPrivateFieldGet(this,_Wilson_minWorldHeight,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldHeight,"f"))throw new Error("[Wilson] minWorldX and minWorldY must be less than maxWorldX and maxWorldY, repsectively");this.clampWorldCoordinatesMode=null!=(e=options.clampWorldCoordinatesMode)?e:"one",__classPrivateFieldSet(this,_Wilson_onResizeCanvasCallback,null!=(e=null==options?void 0:options.onResizeCanvas)?e:()=>{},"f"),__classPrivateFieldSet(this,_Wilson_useP3ColorSpace,null==(e=options.useP3ColorSpace)||e,"f"),this.useP3ColorSpace=__classPrivateFieldGet(this,_Wilson_useP3ColorSpace,"f"),this.reduceMotion=null!=(e=options.reduceMotion)?e:matchMedia("(prefers-reduced-motion: reduce)").matches,__classPrivateFieldSet(this,_Wilson_interactionCallbacks,{...defaultInteractionCallbacks,...null==(e=options.interactionOptions)?void 0:e.callbacks},"f"),this.useInteractionForPanAndZoom=null!=(e=null==(e=options.interactionOptions)?void 0:e.useForPanAndZoom)&&e,__classPrivateFieldSet(this,_Wilson_panFriction,.875,"f"),__classPrivateFieldSet(this,_Wilson_zoomFriction,.85,"f"),null!=(e=options.interactionOptions)&&e.useForPanAndZoom&&(__classPrivateFieldSet(this,_Wilson_interactionOnPanAndZoom,null!=(e=null==(e=options.interactionOptions)?void 0:e.onPanAndZoom)?e:()=>{},"f"),__classPrivateFieldSet(this,_Wilson_panFriction,null!=(e=null==(e=options.interactionOptions)?void 0:e.panFriction)?e:__classPrivateFieldGet(this,_Wilson_panFriction,"f"),"f"),__classPrivateFieldSet(this,_Wilson_zoomFriction,null!=(e=null==(e=options.interactionOptions)?void 0:e.zoomFriction)?e:__classPrivateFieldGet(this,_Wilson_zoomFriction,"f"),"f"),!1===(null==(e=options.interactionOptions)?void 0:e.inertia)&&(__classPrivateFieldSet(this,_Wilson_panFriction,0,"f"),__classPrivateFieldSet(this,_Wilson_zoomFriction,0,"f"),__classPrivateFieldSet(this,_Wilson_panVelocityThreshold,1/0,"f"),__classPrivateFieldSet(this,_Wilson_zoomVelocityThreshold,1/0,"f")),this.usePanAndZoomRubberbanding=null!=(e=null==(e=options.interactionOptions)?void 0:e.rubberbanding)&&e,this.rubberbandingPanSoftness=null!=(e=null==(e=options.interactionOptions)?void 0:e.rubberbandingPanSoftness)?e:3.5,this.rubberbandingZoomSoftness=null!=(e=null==(e=options.interactionOptions)?void 0:e.rubberbandingZoomSoftness)?e:2,this.disallowZooming=null!=(e=null==(e=options.interactionOptions)?void 0:e.disallowZooming)&&e,__classPrivateFieldSet(this,_Wilson_lastVelocityFactors,Array(__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")).fill(1),"f"),__classPrivateFieldSet(this,_Wilson_lastPanVelocitiesX,Array(__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")).fill(0),"f"),__classPrivateFieldSet(this,_Wilson_lastPanVelocitiesY,Array(__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")).fill(0),"f"),__classPrivateFieldSet(this,_Wilson_lastZoomVelocities,Array(__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")).fill(0),"f")),__classPrivateFieldSet(this,_Wilson_draggablesRadius,null!=(e=null==(e=options.draggableOptions)?void 0:e.radius)?e:12,"f"),__classPrivateFieldSet(this,_Wilson_draggablesStatic,null!=(e=null==(e=options.draggableOptions)?void 0:e.static)&&e,"f"),__classPrivateFieldSet(this,_Wilson_draggableCallbacks,{...defaultDraggableCallbacks,...null==(e=options.draggableOptions)?void 0:e.callbacks},"f"),__classPrivateFieldSet(this,_Wilson_fullscreenFillScreen,null!=(e=null==(e=options.fullscreenOptions)?void 0:e.fillScreen)&&e,"f"),this.animateFullscreen=null==(e=null==(e=options.fullscreenOptions)?void 0:e.animate)||e,this.closeFullscreenWithEscape=null==(e=null==(e=options.fullscreenOptions)?void 0:e.closeWithEscape)||e,this.beforeSwitchFullscreen=null!=(e=null==(e=options.fullscreenOptions)?void 0:e.beforeSwitch)?e:()=>{},this.onSwitchFullscreen=null!=(e=null==(e=options.fullscreenOptions)?void 0:e.onSwitch)?e:()=>{},__classPrivateFieldSet(this,_Wilson_fullscreenUseButton,null!=(e=null==(e=options.fullscreenOptions)?void 0:e.useFullscreenButton)&&e,"f"),null!=(e=options.fullscreenOptions)&&e.useFullscreenButton&&(__classPrivateFieldSet(this,_Wilson_fullscreenEnterFullscreenButtonIconPath,null==(e=options.fullscreenOptions)?void 0:e.enterFullscreenButtonIconPath,"f"),__classPrivateFieldSet(this,_Wilson_fullscreenExitFullscreenButtonIconPath,null==(e=options.fullscreenOptions)?void 0:e.exitFullscreenButtonIconPath,"f")),__classPrivateFieldSet(this,_Wilson_appletContainer,document.createElement("div"),"f"),__classPrivateFieldGet(this,_Wilson_appletContainer,"f").classList.add("WILSON_applet-container"),__classPrivateFieldGet(this,_Wilson_appletContainer,"f").classList.add("WILSON_center-content"),this.canvas.parentElement&&this.canvas.parentElement.insertBefore(__classPrivateFieldGet(this,_Wilson_appletContainer,"f"),this.canvas),__classPrivateFieldSet(this,_Wilson_canvasContainer,document.createElement("div"),"f"),__classPrivateFieldGet(this,_Wilson_canvasContainer,"f").classList.add("WILSON_canvas-container"),__classPrivateFieldGet(this,_Wilson_appletContainer,"f").appendChild(__classPrivateFieldGet(this,_Wilson_canvasContainer,"f")),__classPrivateFieldGet(this,_Wilson_canvasContainer,"f").appendChild(this.canvas),__classPrivateFieldSet(this,_Wilson_draggablesContainer,document.createElement("div"),"f"),__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f").classList.add("WILSON_draggables-container"),__classPrivateFieldGet(this,_Wilson_appletContainer,"f").appendChild(__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f")),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_updateDraggablesContainerSize).call(this),__classPrivateFieldSet(this,_Wilson_fullscreenContainer,document.createElement("div"),"f"),__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f").classList.add("WILSON_fullscreen-container"),__classPrivateFieldGet(this,_Wilson_appletContainer,"f").parentElement&&__classPrivateFieldGet(this,_Wilson_appletContainer,"f").parentElement.insertBefore(__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f"),__classPrivateFieldGet(this,_Wilson_appletContainer,"f")),__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f").appendChild(__classPrivateFieldGet(this,_Wilson_appletContainer,"f")),__classPrivateFieldSet(this,_Wilson_fullscreenContainerLocation,document.createElement("div"),"f"),__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f").parentElement&&__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f").parentElement.insertBefore(__classPrivateFieldGet(this,_Wilson_fullscreenContainerLocation,"f"),__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f")),__classPrivateFieldGet(this,_Wilson_fullscreenContainerLocation,"f").appendChild(__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f")),__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f")||(__classPrivateFieldSet(this,_Wilson_metaThemeColorElement,document.createElement("meta"),"f"),__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f").setAttribute("name","theme-color"),document.head.appendChild(__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f")));for(const canvas of[this.canvas,__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f")])canvas.addEventListener("gesturestart",e=>e.preventDefault()),canvas.addEventListener("gesturechange",e=>e.preventDefault()),canvas.addEventListener("gestureend",e=>e.preventDefault()),canvas.addEventListener("click",e=>e.preventDefault());__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_clampWorldCoordinates).call(this),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_initInteraction).call(this),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_initDraggables).call(this),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_initFullscreen).call(this),requestAnimationFrame(__classPrivateFieldGet(this,_Wilson_animationFrameLoop,"f")),window.addEventListener("resize",__classPrivateFieldGet(this,_Wilson_onResizeWindow,"f")),document.documentElement.addEventListener("keydown",__classPrivateFieldGet(this,_Wilson_handleKeydownEvent,"f")),null!=(e=options.draggableOptions)&&e.draggables&&this.setDraggables(options.draggableOptions.draggables),console.log(`[Wilson] Initialized a ${__classPrivateFieldGet(this,_Wilson_canvasWidth,"f")}x${__classPrivateFieldGet(this,_Wilson_canvasHeight,"f")} canvas`+(this.canvas.id?" with ID "+this.canvas.id:""))}destroy(){__classPrivateFieldSet(this,_Wilson_destroyed,!0,"f"),window.removeEventListener("resize",__classPrivateFieldGet(this,_Wilson_onResizeWindow,"f")),document.documentElement.removeEventListener("keydown",__classPrivateFieldGet(this,_Wilson_handleKeydownEvent,"f")),document.documentElement.removeEventListener("mousemove",__classPrivateFieldGet(this,_Wilson_documentDraggableMousemoveListener,"f")),document.documentElement.removeEventListener("mouseup",__classPrivateFieldGet(this,_Wilson_documentDraggableMouseupListener,"f")),document.removeEventListener("gesturestart",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),document.removeEventListener("gesturechange",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),document.removeEventListener("gestureend",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),__classPrivateFieldGet(this,_Wilson_fullscreenContainerLocation,"f")&&__classPrivateFieldGet(this,_Wilson_fullscreenContainerLocation,"f").parentElement&&__classPrivateFieldGet(this,_Wilson_fullscreenContainerLocation,"f").parentElement.insertBefore(this.canvas,__classPrivateFieldGet(this,_Wilson_fullscreenContainerLocation,"f")),__classPrivateFieldGet(this,_Wilson_fullscreenContainerLocation,"f").remove()}resizeCanvas(dimensions){var e;__classPrivateFieldGet(this,_Wilson_currentlyFullscreen,"f")||(e=getComputedStyle(this.canvas),__classPrivateFieldSet(this,_Wilson_canvasAspectRatio,parseFloat(e.width)/parseFloat(e.height),"f")),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_resizeCanvas).call(this,dimensions)&&__classPrivateFieldGet(this,_Wilson_onResizeCanvasCallback,"f").call(this)}resizeWorld({width,height,centerX,centerY,minWidth,maxWidth,minHeight,maxHeight,minX,maxX,minY,maxY}){var e,i=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),s=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),t=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),l=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),a=__classPrivateFieldGet(this,_Wilson_currentlyFullscreen,"f")&&__classPrivateFieldGet(this,_Wilson_fullscreenFillScreen,"f")?window.innerWidth/window.innerHeight:__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f");if(void 0!==width&&void 0!==height?(__classPrivateFieldSet(this,_Wilson_worldWidth,width,"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,height,"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),e=a/__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldWidth,width/Math.max(e,1),"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldHeight,height*Math.min(e,1),"f")):void 0!==width?(__classPrivateFieldSet(this,_Wilson_worldWidth,width,"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,width/a,"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldWidth,width,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldHeight,width/__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f"),"f")):void 0!==height&&(__classPrivateFieldSet(this,_Wilson_worldHeight,height,"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldSet(this,_Wilson_worldWidth,height*a,"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldHeight,height,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldWidth,height*__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f"),"f")),__classPrivateFieldSet(this,_Wilson_worldCenterX,null!=centerX?centerX:__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,null!=centerY?centerY:__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),__classPrivateFieldSet(this,_Wilson_minWorldX,null!=minX?minX:__classPrivateFieldGet(this,_Wilson_minWorldX,"f"),"f"),__classPrivateFieldSet(this,_Wilson_maxWorldX,null!=maxX?maxX:__classPrivateFieldGet(this,_Wilson_maxWorldX,"f"),"f"),__classPrivateFieldSet(this,_Wilson_minWorldY,null!=minY?minY:__classPrivateFieldGet(this,_Wilson_minWorldY,"f"),"f"),__classPrivateFieldSet(this,_Wilson_maxWorldY,null!=maxY?maxY:__classPrivateFieldGet(this,_Wilson_maxWorldY,"f"),"f"),__classPrivateFieldSet(this,_Wilson_maxWorldWidth,void 0!==minX&&void 0!==maxX?maxX-minX:null!=maxWidth?maxWidth:__classPrivateFieldGet(this,_Wilson_maxWorldWidth,"f"),"f"),__classPrivateFieldSet(this,_Wilson_minWorldWidth,null!=minWidth?minWidth:__classPrivateFieldGet(this,_Wilson_minWorldWidth,"f"),"f"),__classPrivateFieldSet(this,_Wilson_maxWorldHeight,void 0!==minY&&void 0!==maxY?maxY-minY:null!=maxHeight?maxHeight:__classPrivateFieldGet(this,_Wilson_maxWorldHeight,"f"),"f"),__classPrivateFieldSet(this,_Wilson_minWorldHeight,null!=minHeight?minHeight:__classPrivateFieldGet(this,_Wilson_minWorldHeight,"f"),"f"),__classPrivateFieldGet(this,_Wilson_minWorldX,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldX,"f")||__classPrivateFieldGet(this,_Wilson_minWorldY,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldY,"f")||__classPrivateFieldGet(this,_Wilson_minWorldWidth,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldWidth,"f")||__classPrivateFieldGet(this,_Wilson_minWorldHeight,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldHeight,"f"))throw new Error("[Wilson] minWorldX and minWorldY must be less than maxWorldX and maxWorldY, repsectively");__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_clampWorldCoordinates).call(this),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_updateDraggablesLocation).call(this),!this.useInteractionForPanAndZoom||__classPrivateFieldGet(this,_Wilson_worldWidth,"f")===i&&__classPrivateFieldGet(this,_Wilson_worldHeight,"f")===s&&__classPrivateFieldGet(this,_Wilson_worldCenterX,"f")===t&&__classPrivateFieldGet(this,_Wilson_worldCenterY,"f")===l||__classPrivateFieldGet(this,_Wilson_interactionOnPanAndZoom,"f").call(this)}setDraggables(draggables){for(const[n,_]of Object.entries(draggables)){var i,[s,t]=_,l=Math.floor(__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedHeight,"f")*(1-((t-__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"))/__classPrivateFieldGet(this,_Wilson_worldHeight,"f")+.5)))+__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),a=Math.floor(__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedWidth,"f")*((s-__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"))/__classPrivateFieldGet(this,_Wilson_worldWidth,"f")+.5))+__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),l=Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),l),__classPrivateFieldGet(this,_Wilson_draggablesContainerHeight,"f")-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")),a=Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),a),__classPrivateFieldGet(this,_Wilson_draggablesContainerWidth,"f")-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"));__classPrivateFieldSet(this,_Wilson_draggableDefaultId,(i=__classPrivateFieldGet(this,_Wilson_draggableDefaultId,"f"),++i),"f"),__classPrivateFieldGet(this,_Wilson_draggables,"f")[n]?(__classPrivateFieldGet(this,_Wilson_draggables,"f")[n].location=[s,t],this.draggables[n].location=[s,t],__classPrivateFieldGet(this,_Wilson_draggables,"f")[n].element.style.transform=`translate(${a-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px, ${l-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px)`):((i=document.createElement("div")).classList.add("WILSON_draggable"),i.id="WILSON_draggable-"+n,i.style.transform=`translate(${a-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px, ${l-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px)`,i.addEventListener("mousedown",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_draggableOnMousedown).call(this,e,n)),i.addEventListener("mouseup",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_draggableOnMouseup).call(this,e,n)),i.addEventListener("mousemove",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_draggableOnMousemove).call(this,e,n)),i.addEventListener("touchstart",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_draggableOnTouchstart).call(this,e,n)),i.addEventListener("touchend",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_draggableOnTouchend).call(this,e,n)),i.addEventListener("touchmove",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_draggableOnTouchmove).call(this,e,n)),__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f").appendChild(i),__classPrivateFieldGet(this,_Wilson_draggables,"f")[n]={element:i,location:[s,t],currentlyDragging:!1},this.draggables[n]={element:i,location:[s,t],currentlyDragging:!1})}}removeDraggables(id){for(const e of Array.isArray(id)?id:[id])__classPrivateFieldGet(this,_Wilson_draggables,"f")[e].element.remove(),delete __classPrivateFieldGet(this,_Wilson_draggables,"f")[e],delete this.draggables[e]}async enterFullscreen(){await this.beforeSwitchFullscreen(!0);for(const s of[__classPrivateFieldGet(this,_Wilson_fullscreenEnterFullscreenButton,"f"),__classPrivateFieldGet(this,_Wilson_fullscreenExitFullscreenButton,"f"),this.canvas,...Object.values(__classPrivateFieldGet(this,_Wilson_draggables,"f")).map(draggable=>draggable.element)])s&&s.style.removeProperty("view-transition-name");if(document.startViewTransition){if(!__classPrivateFieldGet(this,_Wilson_fullscreenFillScreen,"f")&&!this.reduceMotion){__classPrivateFieldGet(this,_Wilson_fullscreenEnterFullscreenButton,"f")&&__classPrivateFieldGet(this,_Wilson_fullscreenEnterFullscreenButton,"f").style.setProperty("view-transition-name","WILSON_fullscreen-button-"+__classPrivateFieldGet(this,_Wilson_salt,"f")),__classPrivateFieldGet(this,_Wilson_fullscreenExitFullscreenButton,"f")&&__classPrivateFieldGet(this,_Wilson_fullscreenExitFullscreenButton,"f").style.setProperty("view-transition-name","WILSON_fullscreen-button-"+__classPrivateFieldGet(this,_Wilson_salt,"f")),this.canvas.style.setProperty("view-transition-name","WILSON_canvas-"+__classPrivateFieldGet(this,_Wilson_salt,"f"));for(var[e,i]of Object.entries(__classPrivateFieldGet(this,_Wilson_draggables,"f")))i.element.style.setProperty("view-transition-name",`WILSON_draggable-${e}-`+__classPrivateFieldGet(this,_Wilson_salt,"f"))}this.animateFullscreen?document.startViewTransition(()=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_enterFullscreen).call(this)):__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_enterFullscreen).call(this)}else __classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_enterFullscreen).call(this)}async exitFullscreen(){await this.beforeSwitchFullscreen(!1),document.startViewTransition&&(__classPrivateFieldGet(this,_Wilson_fullscreenFillScreen,"f")||this.reduceMotion||this.canvas.style.setProperty("view-transition-name","WILSON_canvas-"+__classPrivateFieldGet(this,_Wilson_salt,"f")),this.animateFullscreen)?document.startViewTransition(()=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_exitFullscreen).call(this)):__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_exitFullscreen).call(this)}interpolateCanvasToWorld([row,col]){return[(col/__classPrivateFieldGet(this,_Wilson_canvasWidth,"f")-.5)*__classPrivateFieldGet(this,_Wilson_worldWidth,"f")+__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),(.5-row/__classPrivateFieldGet(this,_Wilson_canvasHeight,"f"))*__classPrivateFieldGet(this,_Wilson_worldHeight,"f")+__classPrivateFieldGet(this,_Wilson_worldCenterY,"f")]}interpolateWorldToCanvas([x,y]){return[Math.floor((.5-(y-__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"))/__classPrivateFieldGet(this,_Wilson_worldHeight,"f"))*__classPrivateFieldGet(this,_Wilson_canvasHeight,"f")),Math.floor(((x-__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"))/__classPrivateFieldGet(this,_Wilson_worldWidth,"f")+.5)*__classPrivateFieldGet(this,_Wilson_canvasWidth,"f"))]}}_Wilson_destroyed=new WeakMap,_Wilson_canvasWidth=new WeakMap,_Wilson_canvasHeight=new WeakMap,_Wilson_lastCanvasWidth=new WeakMap,_Wilson_lastCanvasHeight=new WeakMap,_Wilson_canvasAspectRatio=new WeakMap,_Wilson_worldWidth=new WeakMap,_Wilson_worldHeight=new WeakMap,_Wilson_worldCenterX=new WeakMap,_Wilson_worldCenterY=new WeakMap,_Wilson_nonFullscreenWorldWidth=new WeakMap,_Wilson_nonFullscreenWorldHeight=new WeakMap,_Wilson_minWorldWidth=new WeakMap,_Wilson_maxWorldWidth=new WeakMap,_Wilson_minWorldHeight=new WeakMap,_Wilson_maxWorldHeight=new WeakMap,_Wilson_minWorldX=new WeakMap,_Wilson_maxWorldX=new WeakMap,_Wilson_minWorldY=new WeakMap,_Wilson_maxWorldY=new WeakMap,_Wilson_onResizeCanvasCallback=new WeakMap,_Wilson_useP3ColorSpace=new WeakMap,_Wilson_needDraggablesContainerSizeUpdate=new WeakMap,_Wilson_interactionCallbacks=new WeakMap,_Wilson_needPanAndZoomUpdate=new WeakMap,_Wilson_interactionOnPanAndZoom=new WeakMap,_Wilson_numPreviousVelocities=new WeakMap,_Wilson_lastVelocityFactors=new WeakMap,_Wilson_lastPanVelocityX=new WeakMap,_Wilson_lastPanVelocityY=new WeakMap,_Wilson_lastZoomVelocity=new WeakMap,_Wilson_lastPanVelocitiesX=new WeakMap,_Wilson_lastPanVelocitiesY=new WeakMap,_Wilson_lastZoomVelocities=new WeakMap,_Wilson_panVelocityX=new WeakMap,_Wilson_panVelocityY=new WeakMap,_Wilson_zoomVelocity=new WeakMap,_Wilson_panFriction=new WeakMap,_Wilson_zoomFriction=new WeakMap,_Wilson_panVelocityThreshold=new WeakMap,_Wilson_zoomVelocityThreshold=new WeakMap,_Wilson_draggablesRadius=new WeakMap,_Wilson_draggablesStatic=new WeakMap,_Wilson_draggableCallbacks=new WeakMap,_Wilson_draggablesContainerWidth=new WeakMap,_Wilson_draggablesContainerHeight=new WeakMap,_Wilson_draggablesContainerRestrictedWidth=new WeakMap,_Wilson_draggablesContainerRestrictedHeight=new WeakMap,_Wilson_currentlyFullscreen=new WeakMap,_Wilson_fullscreenOldScroll=new WeakMap,_Wilson_fullscreenFillScreen=new WeakMap,_Wilson_fullscreenUseButton=new WeakMap,_Wilson_fullscreenEnterFullscreenButton=new WeakMap,_Wilson_fullscreenExitFullscreenButton=new WeakMap,_Wilson_fullscreenEnterFullscreenButtonIconPath=new WeakMap,_Wilson_fullscreenExitFullscreenButtonIconPath=new WeakMap,_Wilson_appletContainer=new WeakMap,_Wilson_canvasContainer=new WeakMap,_Wilson_draggablesContainer=new WeakMap,_Wilson_fullscreenContainer=new WeakMap,_Wilson_fullscreenContainerLocation=new WeakMap,_Wilson_metaThemeColorElement=new WeakMap,_Wilson_oldMetaThemeColor=new WeakMap,_Wilson_salt=new WeakMap,_Wilson_onResizeWindow=new WeakMap,_Wilson_handleKeydownEvent=new WeakMap,_Wilson_currentlyDragging=new WeakMap,_Wilson_currentlyPinching=new WeakMap,_Wilson_currentlyWheeling=new WeakMap,_Wilson_currentlyWheelingTimeoutId=new WeakMap,_Wilson_ignoreTouchendCooldown=new WeakMap,_Wilson_atMaxWorldSize=new WeakMap,_Wilson_atMinWorldSize=new WeakMap,_Wilson_lastInteractionRow=new WeakMap,_Wilson_lastInteractionCol=new WeakMap,_Wilson_lastInteractionRow2=new WeakMap,_Wilson_lastInteractionCol2=new WeakMap,_Wilson_zoomFixedPoint=new WeakMap,_Wilson_lastPanAndZoomTimestamp=new WeakMap,_Wilson_animationFrameLoop=new WeakMap,_Wilson_draggables=new WeakMap,_Wilson_draggableDefaultId=new WeakMap,_Wilson_currentMouseDraggableId=new WeakMap,_Wilson_documentDraggableMousemoveListener=new WeakMap,_Wilson_documentDraggableMouseupListener=new WeakMap,_Wilson_preventGestures=new WeakMap,_Wilson_canvasOldWidth=new WeakMap,_Wilson_canvasOldWidthStyle=new WeakMap,_Wilson_canvasOldHeightStyle=new WeakMap,_Wilson_instances=new WeakSet,_Wilson_resizeCanvas=function(dimensions){var e=__classPrivateFieldGet(this,_Wilson_currentlyFullscreen,"f")&&__classPrivateFieldGet(this,_Wilson_fullscreenFillScreen,"f")?window.innerWidth/window.innerHeight:__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f");return void 0!==dimensions.width?(__classPrivateFieldSet(this,_Wilson_canvasWidth,Math.round(dimensions.width),"f"),this.canvasWidth=__classPrivateFieldGet(this,_Wilson_canvasWidth,"f"),__classPrivateFieldSet(this,_Wilson_canvasHeight,Math.round(dimensions.width/e),"f")):(__classPrivateFieldSet(this,_Wilson_canvasWidth,Math.round(dimensions.height*e),"f"),this.canvasWidth=__classPrivateFieldGet(this,_Wilson_canvasWidth,"f"),__classPrivateFieldSet(this,_Wilson_canvasHeight,Math.round(dimensions.height),"f")),this.canvasHeight=__classPrivateFieldGet(this,_Wilson_canvasHeight,"f"),(__classPrivateFieldGet(this,_Wilson_lastCanvasWidth,"f")!==__classPrivateFieldGet(this,_Wilson_canvasWidth,"f")||__classPrivateFieldGet(this,_Wilson_lastCanvasHeight,"f")!==__classPrivateFieldGet(this,_Wilson_canvasHeight,"f"))&&(this.canvas.setAttribute("width",__classPrivateFieldGet(this,_Wilson_canvasWidth,"f").toString()),this.canvas.setAttribute("height",__classPrivateFieldGet(this,_Wilson_canvasHeight,"f").toString()),this.resizeCanvasGPU(),__classPrivateFieldSet(this,_Wilson_lastCanvasWidth,__classPrivateFieldGet(this,_Wilson_canvasWidth,"f"),"f"),__classPrivateFieldSet(this,_Wilson_lastCanvasHeight,__classPrivateFieldGet(this,_Wilson_canvasHeight,"f"),"f"),!0)},_Wilson_zeroVelocities=function(){__classPrivateFieldSet(this,_Wilson_panVelocityX,0,"f"),__classPrivateFieldSet(this,_Wilson_panVelocityY,0,"f"),__classPrivateFieldSet(this,_Wilson_zoomVelocity,0,"f"),__classPrivateFieldSet(this,_Wilson_lastPanVelocityX,0,"f"),__classPrivateFieldSet(this,_Wilson_lastPanVelocityY,0,"f"),__classPrivateFieldSet(this,_Wilson_lastZoomVelocity,0,"f"),__classPrivateFieldSet(this,_Wilson_lastVelocityFactors,Array(__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")).fill(1),"f"),__classPrivateFieldSet(this,_Wilson_lastPanVelocitiesX,Array(__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")).fill(0),"f"),__classPrivateFieldSet(this,_Wilson_lastPanVelocitiesY,Array(__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")).fill(0),"f"),__classPrivateFieldSet(this,_Wilson_lastZoomVelocities,Array(__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")).fill(0),"f")},_Wilson_setLastZoomVelocity=function(lastZoomVelocity){Math.abs(lastZoomVelocity)>Math.abs(__classPrivateFieldGet(this,_Wilson_lastZoomVelocity,"f"))&&__classPrivateFieldSet(this,_Wilson_lastZoomVelocity,lastZoomVelocity,"f")},_Wilson_setLastPanVelocity=function(lastPanVelocityX,lastPanVelocityY){Math.abs(lastPanVelocityX)>Math.abs(__classPrivateFieldGet(this,_Wilson_lastPanVelocityX,"f"))&&__classPrivateFieldSet(this,_Wilson_lastPanVelocityX,lastPanVelocityX,"f"),Math.abs(lastPanVelocityY)>Math.abs(__classPrivateFieldGet(this,_Wilson_lastPanVelocityY,"f"))&&__classPrivateFieldSet(this,_Wilson_lastPanVelocityY,lastPanVelocityY,"f")},_Wilson_setZoomVelocity=function(){if(!this.disallowZooming){__classPrivateFieldSet(this,_Wilson_zoomVelocity,0,"f");for(let e=0;e<__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f");e++)__classPrivateFieldSet(this,_Wilson_zoomVelocity,__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f")+Math.sign(__classPrivateFieldGet(this,_Wilson_lastZoomVelocities,"f")[e])*__classPrivateFieldGet(this,_Wilson_lastZoomVelocities,"f")[e]**2,"f");__classPrivateFieldSet(this,_Wilson_zoomVelocity,Math.sign(__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f"))*Math.sqrt(Math.abs(__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f"))/__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f")),"f"),Math.abs(__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f"))<__classPrivateFieldGet(this,_Wilson_zoomVelocityThreshold,"f")&&__classPrivateFieldSet(this,_Wilson_zoomVelocity,0,"f")}},_Wilson_setPanVelocity=function(){__classPrivateFieldSet(this,_Wilson_panVelocityX,0,"f"),__classPrivateFieldSet(this,_Wilson_panVelocityY,0,"f");for(let s=0;s<__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f");s++)__classPrivateFieldSet(this,_Wilson_panVelocityX,__classPrivateFieldGet(this,_Wilson_panVelocityX,"f")+__classPrivateFieldGet(this,_Wilson_lastPanVelocitiesX,"f")[s]*__classPrivateFieldGet(this,_Wilson_lastVelocityFactors,"f")[s],"f"),__classPrivateFieldSet(this,_Wilson_panVelocityY,__classPrivateFieldGet(this,_Wilson_panVelocityY,"f")+__classPrivateFieldGet(this,_Wilson_lastPanVelocitiesY,"f")[s]*__classPrivateFieldGet(this,_Wilson_lastVelocityFactors,"f")[s],"f");__classPrivateFieldSet(this,_Wilson_panVelocityX,__classPrivateFieldGet(this,_Wilson_panVelocityX,"f")/__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f"),"f"),__classPrivateFieldSet(this,_Wilson_panVelocityY,__classPrivateFieldGet(this,_Wilson_panVelocityY,"f")/__classPrivateFieldGet(this,_Wilson_numPreviousVelocities,"f"),"f");var e=__classPrivateFieldGet(this,_Wilson_panVelocityX,"f")*__classPrivateFieldGet(this,_Wilson_panVelocityX,"f")+__classPrivateFieldGet(this,_Wilson_panVelocityY,"f")*__classPrivateFieldGet(this,_Wilson_panVelocityY,"f"),i=__classPrivateFieldGet(this,_Wilson_panVelocityThreshold,"f")*Math.min(__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldGet(this,_Wilson_worldHeight,"f"));e<i*i&&(__classPrivateFieldSet(this,_Wilson_panVelocityX,0,"f"),__classPrivateFieldSet(this,_Wilson_panVelocityY,0,"f"))},_Wilson_clampWorldCoordinates=function(hardnessFactor=1){__classPrivateFieldSet(this,_Wilson_atMaxWorldSize,!1,"f"),__classPrivateFieldSet(this,_Wilson_atMinWorldSize,!1,"f");var s=factor=>{if(this.usePanAndZoomRubberbanding){if(__classPrivateFieldGet(this,_Wilson_currentlyPinching,"f"))return;factor=Math.pow(factor,hardnessFactor/this.rubberbandingZoomSoftness/(__classPrivateFieldGet(this,_Wilson_currentlyWheeling,"f")?1.5:1)),Math.abs(factor-1)>__classPrivateFieldGet(this,_Wilson_zoomVelocityThreshold,"f")&&__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")}__classPrivateFieldSet(this,_Wilson_worldHeight,__classPrivateFieldGet(this,_Wilson_worldHeight,"f")*factor,"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldSet(this,_Wilson_worldWidth,__classPrivateFieldGet(this,_Wilson_worldWidth,"f")*factor,"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldHeight,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldHeight,"f")*factor,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldWidth,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldWidth,"f")*factor,"f")};let e=1,i=1;__classPrivateFieldGet(this,_Wilson_worldWidth,"f")<__classPrivateFieldGet(this,_Wilson_minWorldWidth,"f")?e=__classPrivateFieldGet(this,_Wilson_minWorldWidth,"f")/__classPrivateFieldGet(this,_Wilson_worldWidth,"f"):__classPrivateFieldGet(this,_Wilson_worldWidth,"f")>__classPrivateFieldGet(this,_Wilson_maxWorldWidth,"f")&&(e=__classPrivateFieldGet(this,_Wilson_maxWorldWidth,"f")/__classPrivateFieldGet(this,_Wilson_worldWidth,"f")),__classPrivateFieldGet(this,_Wilson_worldHeight,"f")<__classPrivateFieldGet(this,_Wilson_minWorldHeight,"f")?i=__classPrivateFieldGet(this,_Wilson_minWorldHeight,"f")/__classPrivateFieldGet(this,_Wilson_worldHeight,"f"):__classPrivateFieldGet(this,_Wilson_worldHeight,"f")>__classPrivateFieldGet(this,_Wilson_maxWorldHeight,"f")&&(i=__classPrivateFieldGet(this,_Wilson_maxWorldHeight,"f")/__classPrivateFieldGet(this,_Wilson_worldHeight,"f"));var t=Math.max(e,i),l=Math.min(e,i);if("both"===this.clampWorldCoordinatesMode?l<1?(s(l),__classPrivateFieldSet(this,_Wilson_atMaxWorldSize,!0,"f")):1<t&&(s(t),__classPrivateFieldSet(this,_Wilson_atMinWorldSize,!0,"f")):t<1?(s(t),__classPrivateFieldSet(this,_Wilson_atMaxWorldSize,!0,"f")):1<l&&(s(l),__classPrivateFieldSet(this,_Wilson_atMinWorldSize,!0,"f")),this.usePanAndZoomRubberbanding&&!__classPrivateFieldGet(this,_Wilson_currentlyDragging,"f")||!this.usePanAndZoomRubberbanding){var t=Math.max(__classPrivateFieldGet(this,_Wilson_minWorldX,"f")+__classPrivateFieldGet(this,_Wilson_worldWidth,"f")/2-__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),0),s=Math.max(__classPrivateFieldGet(this,_Wilson_worldCenterX,"f")-(__classPrivateFieldGet(this,_Wilson_maxWorldX,"f")-__classPrivateFieldGet(this,_Wilson_worldWidth,"f")/2),0),l=Math.max(__classPrivateFieldGet(this,_Wilson_minWorldY,"f")+__classPrivateFieldGet(this,_Wilson_worldHeight,"f")/2-__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),0),a=Math.max(__classPrivateFieldGet(this,_Wilson_worldCenterY,"f")-(__classPrivateFieldGet(this,_Wilson_maxWorldY,"f")-__classPrivateFieldGet(this,_Wilson_worldHeight,"f")/2),0);let e=0!==t&&0!==s||__classPrivateFieldGet(this,_Wilson_worldWidth,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldWidth,"f")?(__classPrivateFieldGet(this,_Wilson_maxWorldX,"f")+__classPrivateFieldGet(this,_Wilson_minWorldX,"f"))/2-__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"):t-s,i=0!==l&&0!==a||__classPrivateFieldGet(this,_Wilson_worldHeight,"f")>=__classPrivateFieldGet(this,_Wilson_maxWorldHeight,"f")?(__classPrivateFieldGet(this,_Wilson_maxWorldY,"f")+__classPrivateFieldGet(this,_Wilson_minWorldY,"f"))/2-__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"):l-a;this.usePanAndZoomRubberbanding&&(e/=this.rubberbandingPanSoftness*hardnessFactor,i/=this.rubberbandingPanSoftness*hardnessFactor),e=isNaN(e)?0:e,i=isNaN(i)?0:i,__classPrivateFieldSet(this,_Wilson_worldCenterX,__classPrivateFieldGet(this,_Wilson_worldCenterX,"f")+e,"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,__classPrivateFieldGet(this,_Wilson_worldCenterY,"f")+i,"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f");t=__classPrivateFieldGet(this,_Wilson_panVelocityThreshold,"f")*Math.min(__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldGet(this,_Wilson_worldHeight,"f"));this.usePanAndZoomRubberbanding&&e**2+i**2>t*t&&__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")}},_Wilson_onMousedown=function(e){var i,s;e.target instanceof HTMLElement&&e.target.classList.contains("WILSON_draggable")||(this.useInteractionForPanAndZoom&&e.preventDefault(),__classPrivateFieldSet(this,_Wilson_currentlyDragging,!0,"f"),this.useInteractionForPanAndZoom&&__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_zeroVelocities).call(this),[i,s]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.clientY,e.clientX]),__classPrivateFieldSet(this,_Wilson_lastInteractionRow,e.clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol,e.clientX,"f"),__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").mousedown({x:i,y:s,event:e}))},_Wilson_onMouseup=function(e){var i,s;e.target instanceof HTMLElement&&e.target.classList.contains("WILSON_draggable")||(this.useInteractionForPanAndZoom&&e.preventDefault(),this.useInteractionForPanAndZoom&&__classPrivateFieldGet(this,_Wilson_currentlyDragging,"f")&&(__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_setPanVelocity).call(this),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")),__classPrivateFieldSet(this,_Wilson_currentlyDragging,!1,"f"),[i,s]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.clientY,e.clientX]),__classPrivateFieldSet(this,_Wilson_lastInteractionRow,e.clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol,e.clientX,"f"),__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").mouseup({x:i,y:s,event:e}))},_Wilson_onMouseleave=function(e){var i,s;e.target instanceof HTMLElement&&e.target.classList.contains("WILSON_draggable")||(this.useInteractionForPanAndZoom&&e.preventDefault(),this.useInteractionForPanAndZoom&&__classPrivateFieldGet(this,_Wilson_currentlyDragging,"f")&&(__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_setPanVelocity).call(this),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")),__classPrivateFieldSet(this,_Wilson_currentlyDragging,!1,"f"),[i,s]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.clientY,e.clientX]),__classPrivateFieldSet(this,_Wilson_lastInteractionRow,e.clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol,e.clientX,"f"),__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").mouseleave({x:i,y:s,event:e}))},_Wilson_onMousemove=function(e){this.useInteractionForPanAndZoom&&e.preventDefault();var[i,s]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.clientY,e.clientX]),[t,l]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[__classPrivateFieldGet(this,_Wilson_lastInteractionRow,"f"),__classPrivateFieldGet(this,_Wilson_lastInteractionCol,"f")]),a=__classPrivateFieldGet(this,_Wilson_currentlyDragging,"f")?__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").mousedrag:__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").mousemove;this.useInteractionForPanAndZoom&&__classPrivateFieldGet(this,_Wilson_currentlyDragging,"f")&&(__classPrivateFieldSet(this,_Wilson_worldCenterX,__classPrivateFieldGet(this,_Wilson_worldCenterX,"f")-(i-t),"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,__classPrivateFieldGet(this,_Wilson_worldCenterY,"f")-(s-l),"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_setLastPanVelocity).call(this,t-i,l-s),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")),a({x:i,y:s,xDelta:i-t,yDelta:s-l,event:e}),__classPrivateFieldSet(this,_Wilson_lastInteractionRow,e.clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol,e.clientX,"f")},_Wilson_updateFromPinching=function({touch1,touch2,lastTouch1,lastTouch2}){var e,i,s;this.disallowZooming||(__classPrivateFieldSet(this,_Wilson_zoomFixedPoint,[(touch1[0]+touch2[0])/2,(touch1[1]+touch2[1])/2],"f"),s=Math.sqrt((touch1[0]-touch2[0])**2+(touch1[1]-touch2[1])**2),e=Math.sqrt((lastTouch1[0]-lastTouch2[0])**2+(lastTouch1[1]-lastTouch2[1])**2),i=[(__classPrivateFieldGet(this,_Wilson_zoomFixedPoint,"f")[0]-__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"))/__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),(__classPrivateFieldGet(this,_Wilson_zoomFixedPoint,"f")[1]-__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"))/__classPrivateFieldGet(this,_Wilson_worldHeight,"f")],e=e/s,__classPrivateFieldSet(this,_Wilson_worldWidth,__classPrivateFieldGet(this,_Wilson_worldWidth,"f")*e,"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,__classPrivateFieldGet(this,_Wilson_worldHeight,"f")*e,"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldWidth,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldWidth,"f")*e,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldHeight,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldHeight,"f")*e,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_setLastZoomVelocity).call(this,200*(e-1)),s=i[0]*__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),e=i[1]*__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),i=__classPrivateFieldGet(this,_Wilson_zoomFixedPoint,"f")[0]-s,s=__classPrivateFieldGet(this,_Wilson_zoomFixedPoint,"f")[1]-e,__classPrivateFieldSet(this,_Wilson_worldCenterX,i,"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,s,"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"))},_Wilson_onTouchstart=function(e){var i,s;e.target instanceof HTMLElement&&e.target.classList.contains("WILSON_draggable")||(this.useInteractionForPanAndZoom&&e.preventDefault(),__classPrivateFieldSet(this,_Wilson_currentlyDragging,!0,"f"),this.useInteractionForPanAndZoom&&__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_zeroVelocities).call(this),[i,s]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.touches[0].clientY,e.touches[0].clientX]),__classPrivateFieldSet(this,_Wilson_lastInteractionRow,e.touches[0].clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol,e.touches[0].clientX,"f"),1<e.touches.length&&(__classPrivateFieldSet(this,_Wilson_currentlyPinching,!0,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionRow2,e.touches[1].clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol2,e.touches[1].clientX,"f")),__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").touchstart({x:i,y:s,event:e}))},_Wilson_onTouchend=function(e){var i,s;e.target instanceof HTMLElement&&e.target.classList.contains("WILSON_draggable")||(this.useInteractionForPanAndZoom&&e.preventDefault(),0!==__classPrivateFieldGet(this,_Wilson_ignoreTouchendCooldown,"f")?0===e.touches.length&&__classPrivateFieldSet(this,_Wilson_currentlyDragging,!1,"f"):(this.useInteractionForPanAndZoom&&__classPrivateFieldGet(this,_Wilson_currentlyDragging,"f")&&0===__classPrivateFieldGet(this,_Wilson_ignoreTouchendCooldown,"f")&&(__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_setPanVelocity).call(this),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")),0===e.touches.length&&__classPrivateFieldSet(this,_Wilson_currentlyDragging,!1,"f"),[i,s]=0===e.touches.length?__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[__classPrivateFieldGet(this,_Wilson_lastInteractionRow,"f"),__classPrivateFieldGet(this,_Wilson_lastInteractionCol,"f")]):__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.touches[0].clientY,e.touches[0].clientX]),0!==e.touches.length&&(__classPrivateFieldSet(this,_Wilson_lastInteractionRow,e.touches[0].clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol,e.touches[0].clientX,"f")),1<e.touches.length?(__classPrivateFieldSet(this,_Wilson_lastInteractionRow2,e.touches[1].clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol2,e.touches[1].clientX,"f")):(__classPrivateFieldGet(this,_Wilson_currentlyPinching,"f")&&(__classPrivateFieldSet(this,_Wilson_ignoreTouchendCooldown,350,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_setZoomVelocity).call(this),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")),__classPrivateFieldSet(this,_Wilson_currentlyPinching,!1,"f")),__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").touchend({x:i,y:s,event:e})))},_Wilson_onTouchmove=function(e){var i,s,t,l,a,n,_;this.useInteractionForPanAndZoom&&e.preventDefault(),0===__classPrivateFieldGet(this,_Wilson_ignoreTouchendCooldown,"f")&&([i,s]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.touches[0].clientY,e.touches[0].clientX]),[t,l]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[__classPrivateFieldGet(this,_Wilson_lastInteractionRow,"f"),__classPrivateFieldGet(this,_Wilson_lastInteractionCol,"f")]),this.useInteractionForPanAndZoom&&__classPrivateFieldGet(this,_Wilson_currentlyDragging,"f")&&(1<e.touches.length?(_=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.touches[1].clientY,e.touches[1].clientX]),a=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[__classPrivateFieldGet(this,_Wilson_lastInteractionRow2,"f"),__classPrivateFieldGet(this,_Wilson_lastInteractionCol2,"f")]),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_updateFromPinching).call(this,{touch1:[i,s],touch2:_,lastTouch1:[t,l],lastTouch2:a}),n=(i+_[0])/2-(t+a[0])/2,_=(s+_[1])/2-(l+a[1])/2,__classPrivateFieldSet(this,_Wilson_worldCenterX,__classPrivateFieldGet(this,_Wilson_worldCenterX,"f")-n,"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,__classPrivateFieldGet(this,_Wilson_worldCenterY,"f")-_,"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_setLastPanVelocity).call(this,-n,-_),__classPrivateFieldSet(this,_Wilson_lastInteractionRow2,e.touches[1].clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol2,e.touches[1].clientX,"f")):(__classPrivateFieldSet(this,_Wilson_worldCenterX,__classPrivateFieldGet(this,_Wilson_worldCenterX,"f")-(i-t),"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,__classPrivateFieldGet(this,_Wilson_worldCenterY,"f")-(s-l),"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_setLastPanVelocity).call(this,t-i,l-s)),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")),__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").touchmove({x:i,y:s,xDelta:i-t,yDelta:s-l,event:e}),__classPrivateFieldSet(this,_Wilson_lastInteractionRow,e.touches[0].clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol,e.touches[0].clientX,"f"))},_Wilson_zoomCanvas=function(scale){var e,i;this.disallowZooming||!this.usePanAndZoomRubberbanding&&(1<scale&&__classPrivateFieldGet(this,_Wilson_atMaxWorldSize,"f")||scale<1&&__classPrivateFieldGet(this,_Wilson_atMinWorldSize,"f"))||(i=[(__classPrivateFieldGet(this,_Wilson_zoomFixedPoint,"f")[0]-__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"))/__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),(__classPrivateFieldGet(this,_Wilson_zoomFixedPoint,"f")[1]-__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"))/__classPrivateFieldGet(this,_Wilson_worldHeight,"f")],__classPrivateFieldSet(this,_Wilson_worldWidth,__classPrivateFieldGet(this,_Wilson_worldWidth,"f")*scale,"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,__classPrivateFieldGet(this,_Wilson_worldHeight,"f")*scale,"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldWidth,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldWidth,"f")*scale,"f"),__classPrivateFieldSet(this,_Wilson_nonFullscreenWorldHeight,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldHeight,"f")*scale,"f"),e=i[0]*__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),i=i[1]*__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterX,__classPrivateFieldGet(this,_Wilson_zoomFixedPoint,"f")[0]-e,"f"),this.worldCenterX=__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),__classPrivateFieldSet(this,_Wilson_worldCenterY,__classPrivateFieldGet(this,_Wilson_zoomFixedPoint,"f")[1]-i,"f"),this.worldCenterY=__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f"))},_Wilson_onWheel=function(e){this.useInteractionForPanAndZoom&&!this.disallowZooming&&e.preventDefault();var i,[s,t]=__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_interpolatePageToWorld).call(this,[e.clientY,e.clientX]);this.useInteractionForPanAndZoom&&(__classPrivateFieldSet(this,_Wilson_zoomFixedPoint,[s,t],"f"),Math.abs(e.deltaY)<40||__classPrivateFieldGet(this,_Wilson_currentlyWheeling,"f")&&Math.abs(e.deltaY)<90?(i=1+.005*(60*(2/(1+Math.pow(1.035,-e.deltaY))-1)),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_zoomCanvas).call(this,i)):__classPrivateFieldSet(this,_Wilson_zoomVelocity,Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_zoomVelocity,"f")+15*Math.sign(e.deltaY),-30),30),"f")),__classPrivateFieldSet(this,_Wilson_currentlyWheeling,!0,"f"),-1!==__classPrivateFieldGet(this,_Wilson_currentlyWheelingTimeoutId,"f")&&clearTimeout(__classPrivateFieldGet(this,_Wilson_currentlyWheelingTimeoutId,"f")),__classPrivateFieldSet(this,_Wilson_currentlyWheelingTimeoutId,setTimeout(()=>{__classPrivateFieldSet(this,_Wilson_currentlyWheeling,!1,"f"),__classPrivateFieldSet(this,_Wilson_currentlyWheelingTimeoutId,-1,"f"),__classPrivateFieldSet(this,_Wilson_needPanAndZoomUpdate,!0,"f")},50),"f"),__classPrivateFieldGet(this,_Wilson_interactionCallbacks,"f").wheel({x:s,y:t,scrollDelta:e.deltaY,event:e}),__classPrivateFieldSet(this,_Wilson_lastInteractionRow,e.clientY,"f"),__classPrivateFieldSet(this,_Wilson_lastInteractionCol,e.clientX,"f")},_Wilson_initInteraction=function(){for(const e of[this.canvas,__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f")])e.addEventListener("mousedown",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_onMousedown).call(this,e)),e.addEventListener("mouseup",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_onMouseup).call(this,e)),e.addEventListener("mousemove",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_onMousemove).call(this,e)),e.addEventListener("touchstart",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_onTouchstart).call(this,e)),e.addEventListener("touchend",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_onTouchend).call(this,e)),e.addEventListener("touchmove",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_onTouchmove).call(this,e)),e.addEventListener("wheel",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_onWheel).call(this,e)),e.addEventListener("mouseleave",e=>__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_onMouseleave).call(this,e))},_Wilson_initDraggables=function(){document.documentElement.addEventListener("mousemove",__classPrivateFieldGet(this,_Wilson_documentDraggableMousemoveListener,"f")),document.documentElement.addEventListener("mouseup",__classPrivateFieldGet(this,_Wilson_documentDraggableMouseupListener,"f"))},_Wilson_draggableOnMousedown=function(e,id){__classPrivateFieldGet(this,_Wilson_draggablesStatic,"f")||(e.preventDefault(),__classPrivateFieldSet(this,_Wilson_currentMouseDraggableId,id,"f"),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].currentlyDragging=!0,this.draggables[id].currentlyDragging=!0,__classPrivateFieldGet(this,_Wilson_draggableCallbacks,"f").grab({id:id,x:__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[0],y:__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[1],event:e}))},_Wilson_draggableOnMouseup=function(e,id){__classPrivateFieldGet(this,_Wilson_draggablesStatic,"f")||(e.preventDefault(),__classPrivateFieldSet(this,_Wilson_currentMouseDraggableId,void 0,"f"),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].currentlyDragging=!1,this.draggables[id].currentlyDragging=!1,__classPrivateFieldSet(this,_Wilson_currentlyDragging,!1,"f"),__classPrivateFieldGet(this,_Wilson_draggableCallbacks,"f").release({id:id,x:__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[0],y:__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[1],event:e}))},_Wilson_draggableOnMousemove=function(e,id){var i,s;__classPrivateFieldGet(this,_Wilson_draggablesStatic,"f")||(e.preventDefault(),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].currentlyDragging&&(i=__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f").getBoundingClientRect(),s=Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),e.clientY-i.top),__classPrivateFieldGet(this,_Wilson_draggablesContainerHeight,"f")-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")),i=Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),e.clientX-i.left),__classPrivateFieldGet(this,_Wilson_draggablesContainerWidth,"f")-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].element.style.transform=`translate(${i-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px, ${s-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px)`,i=(i-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")-__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedWidth,"f")/2)/__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedWidth,"f")*__classPrivateFieldGet(this,_Wilson_worldWidth,"f")+__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),s=-(s-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")-__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedHeight,"f")/2)/__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedHeight,"f")*__classPrivateFieldGet(this,_Wilson_worldHeight,"f")+__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),__classPrivateFieldGet(this,_Wilson_draggableCallbacks,"f").drag({id:id,x:i,y:s,xDelta:i-__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[0],yDelta:s-__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[1],event:e}),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location=[i,s],this.draggables[id].location=[i,s]))},_Wilson_draggableOnTouchstart=function(e,id){__classPrivateFieldGet(this,_Wilson_draggablesStatic,"f")||(e.preventDefault(),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].currentlyDragging=!0,this.draggables[id].currentlyDragging=!0,__classPrivateFieldGet(this,_Wilson_draggableCallbacks,"f").grab({id:id,x:__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[0],y:__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[1],event:e}))},_Wilson_draggableOnTouchend=function(e,id){__classPrivateFieldGet(this,_Wilson_draggablesStatic,"f")||(e.preventDefault(),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].currentlyDragging=!1,this.draggables[id].currentlyDragging=!1,__classPrivateFieldSet(this,_Wilson_currentlyDragging,!1,"f"),__classPrivateFieldGet(this,_Wilson_draggableCallbacks,"f").release({id:id,x:__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[0],y:__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[1],event:e}))},_Wilson_draggableOnTouchmove=function(e,id){if(!__classPrivateFieldGet(this,_Wilson_draggablesStatic,"f")&&(e.preventDefault(),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].currentlyDragging)){const r=__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f").getBoundingClientRect();var l=Array.from(e.touches).map(touch=>{var e=Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),touch.clientY-r.top),__classPrivateFieldGet(this,_Wilson_draggablesContainerHeight,"f")-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")),i=Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),touch.clientX-r.left),__classPrivateFieldGet(this,_Wilson_draggablesContainerWidth,"f")-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"));return[(i-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")-__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedWidth,"f")/2)/__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedWidth,"f")*__classPrivateFieldGet(this,_Wilson_worldWidth,"f")+__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"),-(e-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")-__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedHeight,"f")/2)/__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedHeight,"f")*__classPrivateFieldGet(this,_Wilson_worldHeight,"f")+__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"),e,i]}),a=l.map(coordinate=>(coordinate[0]-__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[0])**2+(coordinate[1]-__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[1])**2);let i=0,s=a[0];for(let t=1;t<a.length;t++)a[t]<s&&(i=t,s=a[t]);var[l,n,_,o]=l[i];__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].element.style.transform=`translate(${o-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px, ${_-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px)`,__classPrivateFieldGet(this,_Wilson_draggableCallbacks,"f").drag({id:id,x:l,y:n,xDelta:l-__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[0],yDelta:n-__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location[1],event:e}),__classPrivateFieldGet(this,_Wilson_draggables,"f")[id].location=[l,n],this.draggables[id].location=[l,n]}},_Wilson_updateDraggablesContainerSize=function(){var e=getComputedStyle(this.canvas),i=this.canvas.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight),s=this.canvas.clientHeight-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom);__classPrivateFieldSet(this,_Wilson_draggablesContainerWidth,i+2*__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),"f"),__classPrivateFieldSet(this,_Wilson_draggablesContainerHeight,s+2*__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),"f"),__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f").style.width=__classPrivateFieldGet(this,_Wilson_draggablesContainerWidth,"f")+"px",__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f").style.height=__classPrivateFieldGet(this,_Wilson_draggablesContainerHeight,"f")+"px",__classPrivateFieldSet(this,_Wilson_draggablesContainerRestrictedWidth,i,"f"),__classPrivateFieldSet(this,_Wilson_draggablesContainerRestrictedHeight,s,"f"),__classPrivateFieldGet(this,_Wilson_draggablesContainer,"f").style.marginTop=parseFloat(e.borderTopWidth)+parseFloat(e.paddingTop)-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")+"px",__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_updateDraggablesLocation).call(this)},_Wilson_updateDraggablesLocation=function(){for(const t in __classPrivateFieldGet(this,_Wilson_draggables,"f")){var e=__classPrivateFieldGet(this,_Wilson_draggables,"f")[t].location[0],i=__classPrivateFieldGet(this,_Wilson_draggables,"f")[t].location[1],s=__classPrivateFieldGet(this,_Wilson_draggables,"f")[t].element,i=Math.floor(__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedHeight,"f")*(1-((i-__classPrivateFieldGet(this,_Wilson_worldCenterY,"f"))/__classPrivateFieldGet(this,_Wilson_worldHeight,"f")+.5)))+__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),e=Math.floor(__classPrivateFieldGet(this,_Wilson_draggablesContainerRestrictedWidth,"f")*((e-__classPrivateFieldGet(this,_Wilson_worldCenterX,"f"))/__classPrivateFieldGet(this,_Wilson_worldWidth,"f")+.5))+__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),i=Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),i),__classPrivateFieldGet(this,_Wilson_draggablesContainerHeight,"f")-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")),e=Math.min(Math.max(__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"),e),__classPrivateFieldGet(this,_Wilson_draggablesContainerWidth,"f")-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f"));s.style.transform=`translate(${e-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px, ${i-__classPrivateFieldGet(this,_Wilson_draggablesRadius,"f")}px)`}},_Wilson_initFullscreen=function(){var e;__classPrivateFieldGet(this,_Wilson_fullscreenUseButton,"f")&&(__classPrivateFieldSet(this,_Wilson_fullscreenEnterFullscreenButton,document.createElement("div"),"f"),__classPrivateFieldGet(this,_Wilson_fullscreenEnterFullscreenButton,"f").classList.add("WILSON_enter-fullscreen-button"),__classPrivateFieldGet(this,_Wilson_canvasContainer,"f").appendChild(__classPrivateFieldGet(this,_Wilson_fullscreenEnterFullscreenButton,"f")),(e=document.createElement("img")).src=__classPrivateFieldGet(this,_Wilson_fullscreenEnterFullscreenButtonIconPath,"f"),__classPrivateFieldGet(this,_Wilson_fullscreenEnterFullscreenButton,"f").appendChild(e),__classPrivateFieldGet(this,_Wilson_fullscreenEnterFullscreenButton,"f").addEventListener("click",()=>{this.enterFullscreen()}),__classPrivateFieldSet(this,_Wilson_fullscreenExitFullscreenButton,document.createElement("div"),"f"),__classPrivateFieldGet(this,_Wilson_fullscreenExitFullscreenButton,"f").classList.add("WILSON_exit-fullscreen-button"),__classPrivateFieldGet(this,_Wilson_canvasContainer,"f").appendChild(__classPrivateFieldGet(this,_Wilson_fullscreenExitFullscreenButton,"f")),(e=document.createElement("img")).src=__classPrivateFieldGet(this,_Wilson_fullscreenExitFullscreenButtonIconPath,"f"),__classPrivateFieldGet(this,_Wilson_fullscreenExitFullscreenButton,"f").appendChild(e),__classPrivateFieldGet(this,_Wilson_fullscreenExitFullscreenButton,"f").addEventListener("click",()=>{this.exitFullscreen()}))},_Wilson_enterFullscreen=function(){var e;__classPrivateFieldSet(this,_Wilson_currentlyFullscreen,!0,"f"),this.currentlyFullscreen=__classPrivateFieldGet(this,_Wilson_currentlyFullscreen,"f"),__classPrivateFieldSet(this,_Wilson_fullscreenOldScroll,window.scrollY,"f"),__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f")&&__classPrivateFieldSet(this,_Wilson_oldMetaThemeColor,__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f").getAttribute("content"),"f"),__classPrivateFieldSet(this,_Wilson_canvasOldWidth,__classPrivateFieldGet(this,_Wilson_canvasWidth,"f"),"f"),__classPrivateFieldSet(this,_Wilson_canvasOldWidthStyle,this.canvas.style.width,"f"),__classPrivateFieldSet(this,_Wilson_canvasOldHeightStyle,this.canvas.style.height,"f"),document.body.appendChild(__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f")),this.canvas.classList.add("WILSON_fullscreen"),__classPrivateFieldGet(this,_Wilson_canvasContainer,"f").classList.add("WILSON_fullscreen"),__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f").classList.add("WILSON_fullscreen"),document.documentElement.style.overflowY="hidden",document.body.style.overflowY="hidden",document.body.style.width="100vw",document.body.style.height="100%",document.documentElement.style.userSelect="none",document.addEventListener("gesturestart",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),document.addEventListener("gesturechange",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),document.addEventListener("gestureend",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f")&&__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f").setAttribute("content","#000000"),__classPrivateFieldGet(this,_Wilson_fullscreenFillScreen,"f")?(__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f").classList.add("WILSON_fullscreen-fill-screen"),this.canvas.style.width="100vw",this.canvas.style.height="100%",window.scroll(0,0),e=window.innerWidth/window.innerHeight/__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f"),__classPrivateFieldSet(this,_Wilson_worldWidth,Math.max(__classPrivateFieldGet(this,_Wilson_worldWidth,"f")*e,__classPrivateFieldGet(this,_Wilson_worldWidth,"f")),"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,Math.max(__classPrivateFieldGet(this,_Wilson_worldHeight,"f")/e,__classPrivateFieldGet(this,_Wilson_worldHeight,"f")),"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_clampWorldCoordinates).call(this)):(this.canvas.style.width=`min(100vw, calc(100vh * ${__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")}))`,this.canvas.style.height=`min(100vh, calc(100vw / ${__classPrivateFieldGet(this,_Wilson_canvasAspectRatio,"f")}))`),__classPrivateFieldGet(this,_Wilson_onResizeWindow,"f").call(this),this.onSwitchFullscreen(!0)},_Wilson_exitFullscreen=function(){__classPrivateFieldSet(this,_Wilson_currentlyFullscreen,!1,"f"),this.currentlyFullscreen=__classPrivateFieldGet(this,_Wilson_currentlyFullscreen,"f"),__classPrivateFieldGet(this,_Wilson_fullscreenFillScreen,"f")&&(__classPrivateFieldSet(this,_Wilson_worldWidth,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldWidth,"f"),"f"),this.worldWidth=__classPrivateFieldGet(this,_Wilson_worldWidth,"f"),__classPrivateFieldSet(this,_Wilson_worldHeight,__classPrivateFieldGet(this,_Wilson_nonFullscreenWorldHeight,"f"),"f"),this.worldHeight=__classPrivateFieldGet(this,_Wilson_worldHeight,"f"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_clampWorldCoordinates).call(this)),__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f")&&(__classPrivateFieldGet(this,_Wilson_oldMetaThemeColor,"f")?"#000000"!==__classPrivateFieldGet(this,_Wilson_oldMetaThemeColor,"f")&&__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f").setAttribute("content",__classPrivateFieldGet(this,_Wilson_oldMetaThemeColor,"f")):__classPrivateFieldGet(this,_Wilson_metaThemeColorElement,"f").removeAttribute("content")),__classPrivateFieldGet(this,_Wilson_fullscreenContainerLocation,"f").appendChild(__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f")),this.canvas.classList.remove("WILSON_fullscreen"),__classPrivateFieldGet(this,_Wilson_canvasContainer,"f").classList.remove("WILSON_fullscreen"),__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f").classList.remove("WILSON_fullscreen"),document.documentElement.style.overflowY="scroll",document.body.style.overflowY="visible",document.body.style.width="",document.body.style.height="",document.documentElement.style.userSelect="auto",document.removeEventListener("gesturestart",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),document.removeEventListener("gesturechange",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),document.removeEventListener("gestureend",__classPrivateFieldGet(this,_Wilson_preventGestures,"f")),__classPrivateFieldGet(this,_Wilson_fullscreenFillScreen,"f")&&(__classPrivateFieldGet(this,_Wilson_fullscreenContainer,"f").classList.remove("WILSON_fullscreen-fill-screen"),__classPrivateFieldGet(this,_Wilson_instances,"m",_Wilson_resizeCanvas).call(this,{width:__classPrivateFieldGet(this,_Wilson_canvasOldWidth,"f")}))&&__classPrivateFieldGet(this,_Wilson_onResizeCanvasCallback,"f").call(this),this.canvas.style.width=__classPrivateFieldGet(this,_Wilson_canvasOldWidthStyle,"f"),this.canvas.style.height=__classPrivateFieldGet(this,_Wilson_canvasOldHeightStyle,"f"),__classPrivateFieldGet(this,_Wilson_onResizeWindow,"f").call(this),this.onSwitchFullscreen(!1),__classPrivateFieldGet(this,_Wilson_fullscreenOldScroll,"f")&&(window.scrollTo(0,__classPrivateFieldGet(this,_Wilson_fullscreenOldScroll,"f")),setTimeout(()=>window.scrollTo(0,__classPrivateFieldGet(this,_Wilson_fullscreenOldScroll,"f")),10))},_Wilson_interpolatePageToWorld=function([row,col]){var e=this.canvas.getBoundingClientRect(),i=window.getComputedStyle(this.canvas),s=parseFloat(i.paddingTop)+parseFloat(i.borderTopWidth),t=parseFloat(i.paddingBottom)+parseFloat(i.borderBottomWidth),l=parseFloat(i.paddingLeft)+parseFloat(i.borderLeftWidth),i=parseFloat(i.paddingRight)+parseFloat(i.borderRightWidth),i=e.width-l-i,t=e.height-s-t,s=(row-e.top-s)*(this.canvasHeight/t),t=(col-e.left-l)*(this.canvasWidth/i);return this.interpolateCanvasToWorld([s,t])};class WilsonCPU extends Wilson{constructor(canvas,options){super(canvas,options);var e=this.useP3ColorSpace&&matchMedia("(color-gamut: p3)").matches?"display-p3":"srgb",e=this.canvas.getContext("2d",{colorSpace:e});if(!e)throw new Error("[Wilson] Could not get 2d context for canvas: "+e);this.ctx=e,this.ctx=canvas.getContext("2d")}drawFrame(image){this.ctx.putImageData(new ImageData(image,this.canvasWidth,this.canvasHeight),0,0)}downloadFrame(filename){this.canvas.toBlob(blob=>{var e;blob?((e=document.createElement("a")).download=filename,e.href=window.URL.createObjectURL(blob),e.click(),e.remove()):console.error("[Wilson] Could not create a blob from a canvas with ID "+this.canvas.id)})}}const uniformFunctions={int:(gl,location,value)=>gl.uniform1i(location,value),float:(gl,location,value)=>gl.uniform1f(location,value),vec2:(gl,location,value)=>gl.uniform2fv(location,value),vec3:(gl,location,value)=>gl.uniform3fv(location,value),vec4:(gl,location,value)=>gl.uniform4fv(location,value),intArray:(gl,location,value)=>gl.uniform1iv(location,value),floatArray:(gl,location,value)=>gl.uniform1fv(location,value),vec2Array:(gl,location,value)=>gl.uniform2fv(location,value.flat()),vec3Array:(gl,location,value)=>gl.uniform3fv(location,value.flat()),vec4Array:(gl,location,value)=>gl.uniform4fv(location,value.flat()),mat2:(gl,location,value)=>gl.uniformMatrix2fv(location,!1,[value[0][0],value[1][0],value[0][1],value[1][1]]),mat3:(gl,location,value)=>gl.uniformMatrix3fv(location,!1,[value[0][0],value[1][0],value[2][0],value[0][1],value[1][1],value[2][1],value[0][2],value[1][2],value[2][2]]),mat4:(gl,location,value)=>gl.uniformMatrix4fv(location,!1,[value[0][0],value[1][0],value[2][0],value[3][0],value[0][1],value[1][1],value[2][1],value[3][1],value[0][2],value[1][2],value[2][2],value[3][2],value[0][3],value[1][3],value[2][3],value[3][3]])};class WilsonGPU extends Wilson{constructor(canvas,options){super(canvas,options),_WilsonGPU_instances.add(this),_WilsonGPU_useWebGL2.set(this,void 0),_WilsonGPU_shaderPrograms.set(this,{}),_WilsonGPU_uniforms.set(this,{}),_WilsonGPU_numShaders.set(this,0),_WilsonGPU_currentShaderId.set(this,"0"),_WilsonGPU_framebuffers.set(this,{}),_WilsonGPU_textures.set(this,{}),this.resizeCanvasGPU=()=>{this.gl.viewport(0,0,this.canvasWidth,this.canvasHeight)},__classPrivateFieldSet(this,_WilsonGPU_useWebGL2,null==(e=options.useWebGL2)||e,"f");var e=__classPrivateFieldGet(this,_WilsonGPU_useWebGL2,"f")&&null!=(e=canvas.getContext("webgl2"))?e:canvas.getContext("webgl");if(!e)throw new Error("[Wilson] Failed to get WebGL or WebGL2 context.");if(this.gl=e,this.gl.getExtension("KHR_parallel_shader_compile"),(this.gl instanceof WebGL2RenderingContext&&!this.gl.getExtension("EXT_color_buffer_float")||this.gl instanceof WebGLRenderingContext&&!this.gl.getExtension("OES_texture_float"))&&console.warn("[Wilson] No support for float textures."),"drawingBufferColorSpace"in this.gl&&this.useP3ColorSpace&&(this.gl.drawingBufferColorSpace="display-p3"),"shader"in options)this.loadShader({shader:options.shader,uniforms:options.uniforms});else{if(!("shaders"in options))throw new Error("[Wilson] Must provide either a single shader or multiple shaders.");for(var[i,s]of Object.entries(options.shaders))this.loadShader({id:i,shader:s,uniforms:null==(s=options.uniforms)?void 0:s[i]})}}drawFrame(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}loadShader({id=__classPrivateFieldGet(this,_WilsonGPU_numShaders,"f").toString(),shader,uniforms={}}){var e=this.gl.createShader(this.gl.VERTEX_SHADER),i=this.gl.createShader(this.gl.FRAGMENT_SHADER);if(!e||!i)throw new Error(`[Wilson] Couldn't create shader: ${e}, `+i);var s=this.gl.createProgram();if(!s)throw new Error("[Wilson] Couldn't create shader program. Full shader source: "+shader);if(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[id]=s,this.gl.attachShader(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[id],e),this.gl.attachShader(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[id],i),this.gl.shaderSource(e,`
			attribute vec3 position;
			varying vec2 uv;

			void main(void)
			{
				gl_Position = vec4(position, 1.0);

				//Interpolate quad coordinates in the fragment shader.
				uv = position.xy;
			}
		`),this.gl.shaderSource(i,shader),this.gl.compileShader(e),this.gl.compileShader(i),this.gl.linkProgram(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[id]),!this.gl.getProgramParameter(s,this.gl.LINK_STATUS))throw new Error(`[Wilson] Couldn't link shader program: ${this.gl.getProgramInfoLog(s)}. Full shader source: `+shader);this.useShader(id);e=this.gl.createBuffer();if(!e)throw new Error("[Wilson] Couldn't create position buffer. Full shader source: "+shader);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),this.gl.STATIC_DRAW);var t,l,i=this.gl.getAttribLocation(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[id],"position");if(-1===i)throw new Error("[Wilson] Couldn't get position attribute. Full shader source: "+shader);this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,3,this.gl.FLOAT,!1,0,0),this.gl.viewport(0,0,this.canvasWidth,this.canvasHeight),__classPrivateFieldGet(this,_WilsonGPU_uniforms,"f")[id]={};for([t,l]of Object.entries(uniforms)){var a=this.gl.getUniformLocation(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[id],t);if(null===a)throw new Error(`[Wilson] Couldn't get uniform location for ${t}. Check that it is used in the shader (so that it is not compiled away). Full shader source: `+shader);var n=shader.match(new RegExp(`uniform\\s+(\\S+?)\\s+${t}(\\[\\d+\\])?\\s*;`));if(!n)throw new Error(`[Wilson] Couldn't find uniform ${t} in shader source: `+shader);n=n[1].trim()+(n[2]?"Array":"");if(!(n in uniformFunctions))throw new Error(`[Wilson] Invalid uniform type ${n} for uniform ${t} in shader source: `+shader);__classPrivateFieldGet(this,_WilsonGPU_uniforms,"f")[id][t]={location:a,type:n},this.setUniforms({[t]:l})}}setUniforms(uniforms,shader=__classPrivateFieldGet(this,_WilsonGPU_currentShaderId,"f")){this.gl.useProgram(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[shader]);for(var[e,i]of Object.entries(uniforms)){if(void 0===__classPrivateFieldGet(this,_WilsonGPU_uniforms,"f")[shader][e])throw new Error(`Uniform ${e} not found in shader `+shader);var{location:e,type:s}=__classPrivateFieldGet(this,_WilsonGPU_uniforms,"f")[shader][e];(0,uniformFunctions[s])(this.gl,e,i)}this.gl.useProgram(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[__classPrivateFieldGet(this,_WilsonGPU_currentShaderId,"f")])}useShader(id){__classPrivateFieldSet(this,_WilsonGPU_currentShaderId,id,"f"),this.gl.useProgram(__classPrivateFieldGet(this,_WilsonGPU_shaderPrograms,"f")[id])}createFramebufferTexturePair({id,width=this.canvasWidth,height=this.canvasHeight,textureType}){if("unsignedByte"!==textureType&&"float"!==textureType)throw new Error(`[Wilson] Invalid texture type "${textureType}".`);var e=this.gl.createFramebuffer();if(!e)throw new Error(`[Wilson] Couldn't create a framebuffer with id ${id}.`);var i=this.gl.createTexture();if(!i)throw new Error(`[Wilson] Couldn't create a texture with id ${id}.`);this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,"float"===textureType&&this.gl instanceof WebGL2RenderingContext?this.gl.RGBA32F:this.gl.RGBA,width,height,0,this.gl.RGBA,"float"===textureType?this.gl.FLOAT:this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.disable(this.gl.DEPTH_TEST),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,i,0),__classPrivateFieldGet(this,_WilsonGPU_framebuffers,"f")[id]=e,__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id]={texture:i,width:width,height:height,type:textureType}}useFramebuffer(id){null===id?this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,__classPrivateFieldGet(this,_WilsonGPU_framebuffers,"f")[id])}useTexture(id){null===id?this.gl.bindTexture(this.gl.TEXTURE_2D,null):this.gl.bindTexture(this.gl.TEXTURE_2D,__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].texture)}setTexture({id,data}){if(!__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id])throw new Error(`[Wilson] Tried to set a texture with id ${id}, but it doesn't exist.`);if(data instanceof Uint8Array&&"unsignedByte"!==__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].type||data instanceof Float32Array&&"float"!==__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].type)throw new Error(`[Wilson] Tried to set a texture with id ${id}, but the data type does not match the texture type (the data type should be a ${"unsignedByte"===__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].type?"Uint8Array":"Float32Array"}).`);this.gl.bindTexture(this.gl.TEXTURE_2D,__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,"float"===__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].type&&this.gl instanceof WebGL2RenderingContext?this.gl.RGBA32F:this.gl.RGBA,__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].width,__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].height,0,this.gl.RGBA,"float"===__classPrivateFieldGet(this,_WilsonGPU_textures,"f")[id].type?this.gl.FLOAT:this.gl.UNSIGNED_BYTE,data)}readPixels(options){var{row:e,col:i,height:s,width:t,format:l}={...{row:0,col:0,height:this.canvasHeight,width:this.canvasWidth,format:"unsignedByte"},...null!=options?options:{}},a=new("float"===l?Float32Array:Uint8Array)(t*s*4);return this.gl.readPixels(i,e,t,s,this.gl.RGBA,"float"===l?this.gl.FLOAT:this.gl.UNSIGNED_BYTE,a),a}downloadFrame(filename,drawNewFrame=!0){drawNewFrame&&this.drawFrame(),this.canvas.toBlob(blob=>{var e;blob?((e=document.createElement("a")).download=filename,e.href=window.URL.createObjectURL(blob),e.click(),e.remove()):console.error("[Wilson] Could not create a blob from a canvas with ID "+this.canvas.id)})}}_WilsonGPU_useWebGL2=new WeakMap,_WilsonGPU_shaderPrograms=new WeakMap,_WilsonGPU_uniforms=new WeakMap,_WilsonGPU_numShaders=new WeakMap,_WilsonGPU_currentShaderId=new WeakMap,_WilsonGPU_framebuffers=new WeakMap,_WilsonGPU_textures=new WeakMap,_WilsonGPU_instances=new WeakSet,_WilsonGPU_loadShaderInternal=function(type,source){var e=this.gl.createShader(type);if(e)return this.gl.shaderSource(e,source),this.gl.compileShader(e),e;throw new Error("[Wilson] Couldn't create shader: "+e)};export{WilsonCPU,WilsonGPU};