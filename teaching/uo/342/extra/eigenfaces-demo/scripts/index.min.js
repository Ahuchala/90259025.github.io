import{A,eigendata,uVectors}from"./data.min.js";import{DownloadButton}from"/scripts/src/buttons.min.js";import{Checkbox}from"/scripts/src/checkboxes.min.js";import{showPage}from"/scripts/src/loadPage.min.js";import{$}from"/scripts/src/main.min.js";import{Slider}from"/scripts/src/sliders.min.js";import{Wilson}from"/scripts/wilson.min.js";export default function(){const s=new Wilson($("#output-canvas"),{renderer:"cpu",canvasWidth:162,canvasHeight:200}),h=s.canvasHeight*s.canvasWidth*4,u=new Array(21),e=(new DownloadButton({element:$("#download-button"),wilson:s,filename:"eigenface.png"}),new Checkbox({element:$("#eigenface-checkbox"),name:"Show eigenface",onInput:t})),f=new Slider({element:$("#index-slider"),name:"Face",value:0,min:0,max:20,onInput:t}),d=new Slider({element:$("#depth-slider"),name:"Depth",value:1,min:1,max:21,onInput:t});function t(){if(e.checked){var t=uVectors[Math.floor(f.value)],a=uVectors[Math.ceil(f.value)],r=f.value-Math.floor(f.value),o=new Array(h);for(let e=0;e<h;e++)o[e]=(1-r)*t[e]+r*a[e];p(o)}else{var n,[s,i=21]=[f.value,d.value],l=new Array(h),c=new Array(21);for(let e=0;e<21;e++){var m=Math.floor(s);c[e]=(1-(s-m))*Math.sqrt(eigendata[e][0])*eigendata[e][1][m]/21,s<20&&(c[e]+=(s-m)*Math.sqrt(eigendata[e][0])*eigendata[e][1][m+1]/21)}for(let t=0;t<h;t++){for(let e=l[t]=0;e<Math.floor(i);e++)l[t]+=c[e]*uVectors[e][t]/u[e];i<20&&(n=Math.floor(i),l[t]+=(i-n)*c[n]*uVectors[n][t]/u[n])}p(l)}}function p(vec){var e=[...vec];let t=0,a=0;for(let o=0;o<e.length;o+=4)t=Math.max(t,e[o]),t=Math.max(t,e[o+1]),t=Math.max(t,e[o+2]),a=Math.min(a,e[o]),a=Math.min(a,e[o+1]),a=Math.min(a,e[o+2]);for(let n=0;n<e.length;n+=4)e[n]=(e[n]-a)/(t-a)*255,e[n+1]=(e[n+1]-a)/(t-a)*255,e[n+2]=(e[n+2]-a)/(t-a)*255,e[n+3]=255;var r=new ImageData(new Uint8ClampedArray(e),s.canvasWidth,s.canvasHeight);s.ctx.putImageData(r,0,0)}showPage(),setTimeout(()=>t(),100);for(let a=0;a<21;a++){let e=0;for(let t=0;t<h;t++)e+=uVectors[a][t]*uVectors[a][t];u[a]=Math.sqrt(e)}}