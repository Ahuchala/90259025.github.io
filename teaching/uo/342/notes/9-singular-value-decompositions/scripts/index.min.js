import{eigendata,uVectors}from"./data.min.js";import{VSingularValues,VU,VW}from"./vData.min.js";import{showPage}from"/scripts/src/loadPage.min.js";import{$}from"/scripts/src/main.min.js";import{Slider}from"/scripts/src/sliders.min.js";import{Wilson}from"/scripts/wilson.min.js";export default function(){{const s=new Wilson($("#v-canvas"),{renderer:"cpu",canvasWidth:400,canvasHeight:300}),o=new Array(s.canvasHeight);for(let a=0;a<s.canvasHeight;a++)o[a]=new Array(s.canvasWidth);const t=new Slider({element:$("#depth-slider"),name:"Depth",value:100,min:1,max:200,integer:!0,logarithmic:!0,onInput:function(){e(t.value)}});function e(depth=200){for(let r=0;r<s.canvasHeight;r++)for(let e=0;e<s.canvasWidth;e++)for(let a=o[r][e]=0;a<depth;a++)o[r][e]+=VSingularValues[a]*VU[r][a]*VW[e][a];var e=o,t=new Uint8ClampedArray(s.canvasWidth*s.canvasHeight*4);for(let i=0;i<s.canvasHeight;i++)for(let a=0;a<s.canvasWidth;a++){var n=4*(s.canvasWidth*i+a);t[n]=e[i][a],t[1+n]=e[i][a],t[2+n]=e[i][a],t[3+n]=255}s.ctx.putImageData(new ImageData(t,s.canvasWidth,s.canvasHeight),0,0)}e()}{const m=44,l=new Wilson($("#eigenface-canvas"),{renderer:"cpu",canvasWidth:100,canvasHeight:100}),d=l.canvasHeight*l.canvasWidth*4,u=new Array(m),f=new Slider({element:$("#index-slider"),name:"Face",value:0,min:0,max:m-1,onInput:a}),g=new Slider({element:$("#depth-2-slider"),name:"Depth",value:1,min:1,max:m,onInput:a}),p=!1;function a(){if(p){var e=uVectors[Math.floor(f.value)],t=uVectors[Math.ceil(f.value)],n=f.value-Math.floor(f.value),r=new Array(d);for(let a=0;a<d;a++)r[a]=(1-n)*e[a]+n*t[a];v(r)}else{var i,[s,o=m]=[f.value,g.value],l=new Array(d),c=new Array(m),h=Math.floor(s);for(let a=0;a<m;a++)c[a]=(1-(s-h))*Math.sqrt(eigendata[a][0])*eigendata[a][1][h]/m,s<m-1&&(c[a]+=(s-h)*Math.sqrt(eigendata[a][0])*eigendata[a][1][h+1]/m);for(let e=0;e<d;e++){for(let a=l[e]=0;a<Math.floor(o);a++)l[e]+=c[a]*uVectors[a][e]/u[a];o<m-1&&(i=Math.floor(o),l[e]+=(o-i)*c[i]*uVectors[i][e]/u[i])}v(l)}}function v(vec){var a=[...vec];let e=0,t=0;for(let r=0;r<a.length;r+=4)e=Math.max(e,a[r]),e=Math.max(e,a[r+1]),e=Math.max(e,a[r+2]),t=Math.min(t,a[r]),t=Math.min(t,a[r+1]),t=Math.min(t,a[r+2]);for(let i=0;i<a.length;i+=4)a[i]=(a[i]-t)/(e-t)*255,a[i+1]=(a[i+1]-t)/(e-t)*255,a[i+2]=(a[i+2]-t)/(e-t)*255,a[i+3]=255;var n=new ImageData(new Uint8ClampedArray(a),l.canvasWidth,l.canvasHeight);l.ctx.putImageData(n,0,0)}setTimeout(()=>a(),100);for(let t=0;t<m;t++){let a=0;for(let e=0;e<d;e++)a+=uVectors[t][e]*uVectors[t][e];u[t]=Math.sqrt(a)}}showPage()}